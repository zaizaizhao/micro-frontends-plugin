{"version":3,"file":"index.js","names":["importHTML","processCssLoader","WuJie","defineWujieWebComponent","addLoading","processAppForHrefJump","getPlugins","wujieSupport","mergeOptions","isFunction","requestIdleCallback","isMatchSyncQueryById","warn","stopMainAppRun","getWujieById","getOptionsById","addSandboxCacheWithOptions","EventBus","WUJIE_TIPS_NOT_SUPPORTED","bus","Date","now","toString","window","__WUJIE","__POWERED_BY_WUJIE__","setupApp","options","name","startApp","startOptions","sandbox","cacheOptions","url","html","replace","fetch","props","attrs","degradeAttrs","fiber","alive","degrade","sync","prefix","el","loading","plugins","lifecycles","iframeWindow","iframe","contentWindow","preload","active","execFlag","beforeLoad","opts","loadError","getExternalScripts","start","activated","destroy","__WUJIE_MOUNT","unmount","beforeMount","afterMount","mountFlag","rebuildStyleSheets","newSandbox","template","getExternalStyleSheets","processedHtml","preloadApp","preOptions","exec","runPreload","destroyApp","id"],"sources":["../src/index.ts"],"sourcesContent":["import importHTML, { processCssLoader } from \"./entry\";\nimport { StyleObject, ScriptAttributes } from \"./template\";\nimport WuJie, { lifecycle } from \"./sandbox\";\nimport { defineWujieWebComponent, addLoading } from \"./shadow\";\nimport { processAppForHrefJump } from \"./sync\";\nimport { getPlugins } from \"./plugin\";\nimport {\n  wujieSupport,\n  mergeOptions,\n  isFunction,\n  requestIdleCallback,\n  isMatchSyncQueryById,\n  warn,\n  stopMainAppRun,\n} from \"./utils\";\nimport { getWujieById, getOptionsById, addSandboxCacheWithOptions } from \"./common\";\nimport { EventBus } from \"./event\";\nimport { WUJIE_TIPS_NOT_SUPPORTED } from \"./constant\";\n\nexport const bus = new EventBus(Date.now().toString());\n\nexport interface ScriptObjectLoader {\n  /** 脚本地址，内联为空 */\n  src?: string;\n  /** 脚本是否为module模块 */\n  module?: boolean;\n  /** 脚本是否为async执行 */\n  async?: boolean;\n  /** 脚本是否设置crossorigin */\n  crossorigin?: boolean;\n  /** 脚本crossorigin的类型 */\n  crossoriginType?: \"anonymous\" | \"use-credentials\" | \"\";\n  /** 脚本原始属性 */\n  attrs?: ScriptAttributes;\n  /** 内联script的代码 */\n  content?: string;\n  /** 执行回调钩子 */\n  callback?: (appWindow: Window) => any;\n  /** 子应用加载完毕事件 */\n  onload?: Function;\n}\nexport interface plugin {\n  /** 处理html的loader */\n  htmlLoader?: (code: string) => string;\n  /** js排除列表 */\n  jsExcludes?: Array<string | RegExp>;\n  /** js忽略列表 */\n  jsIgnores?: Array<string | RegExp>;\n  /** 处理js加载前的loader */\n  jsBeforeLoaders?: Array<ScriptObjectLoader>;\n  /** 处理js的loader */\n  jsLoader?: (code: string, url: string, base: string) => string;\n  /** 处理js加载后的loader */\n  jsAfterLoaders?: Array<ScriptObjectLoader>;\n  /** css排除列表 */\n  cssExcludes?: Array<string | RegExp>;\n  /** css忽略列表 */\n  cssIgnores?: Array<string | RegExp>;\n  /** 处理css加载前的loader */\n  cssBeforeLoaders?: Array<StyleObject>;\n  /** 处理css的loader */\n  cssLoader?: (code: string, url: string, base: string) => string;\n  /** 处理css加载后的loader */\n  cssAfterLoaders?: Array<StyleObject>;\n  /** 子应用 window addEventListener 钩子回调 */\n  windowAddEventListenerHook?: eventListenerHook;\n  /** 子应用 window removeEventListener 钩子回调 */\n  windowRemoveEventListenerHook?: eventListenerHook;\n  /** 子应用 document addEventListener 钩子回调 */\n  documentAddEventListenerHook?: eventListenerHook;\n  /** 子应用 document removeEventListener 钩子回调 */\n  documentRemoveEventListenerHook?: eventListenerHook;\n  /** 子应用 向body、head插入元素后执行的钩子回调 */\n  appendOrInsertElementHook?: <T extends Node>(element: T, iframeWindow: Window) => void;\n  /** 子应用劫持元素的钩子回调 */\n  patchElementHook?: <T extends Node>(element: T, iframeWindow: Window) => void;\n  /** 用户自定义覆盖子应用 window 属性 */\n  windowPropertyOverride?: (iframeWindow: Window) => void;\n  /** 用户自定义覆盖子应用 document 属性 */\n  documentPropertyOverride?: (iframeWindow: Window) => void;\n}\n\ntype eventListenerHook = (\n  iframeWindow: Window,\n  type: string,\n  handler: EventListenerOrEventListenerObject,\n  options?: boolean | AddEventListenerOptions\n) => void;\n\nexport type loadErrorHandler = (url: string, e: Error) => any;\n\ntype baseOptions = {\n  /** 唯一性用户必须保证 */\n  name: string;\n  /** 需要渲染的url */\n  url: string;\n  /** 需要渲染的html, 如果已有则无需从url请求 */\n  html?: string;\n  /** 代码替换钩子 */\n  replace?: (code: string) => string;\n  /** 自定义fetch */\n  fetch?: (input: RequestInfo, init?: RequestInit) => Promise<Response>;\n  /** 注入给子应用的属性 */\n  props?: { [key: string]: any };\n  /** 自定义运行iframe的属性 */\n  attrs?: { [key: string]: any };\n  /** 自定义降级渲染iframe的属性 */\n  degradeAttrs?: { [key: string]: any };\n  /** 子应用采用fiber模式执行 */\n  fiber?: boolean;\n  /** 子应用保活，state不会丢失 */\n  alive?: boolean;\n  /** 子应用采用降级iframe方案 */\n  degrade?: boolean;\n  /** 子应用插件 */\n  plugins?: Array<plugin>;\n  /** 子应用生命周期 */\n  beforeLoad?: lifecycle;\n  beforeMount?: lifecycle;\n  afterMount?: lifecycle;\n  beforeUnmount?: lifecycle;\n  afterUnmount?: lifecycle;\n  activated?: lifecycle;\n  deactivated?: lifecycle;\n  loadError?: loadErrorHandler;\n};\n\nexport type preOptions = baseOptions & {\n  /** 预执行 */\n  exec?: boolean;\n};\n\nexport type startOptions = baseOptions & {\n  /** 渲染的容器 */\n  el: HTMLElement | string;\n  /**\n   * 路由同步开关\n   * 如果false，子应用跳转主应用路由无变化，但是主应用的history还是会增加\n   * https://html.spec.whatwg.org/multipage/history.html#the-history-interface\n   */\n  sync?: boolean;\n  /** 子应用短路径替换，路由同步时生效 */\n  prefix?: { [key: string]: string };\n  /** 子应用加载时loading元素 */\n  loading?: HTMLElement;\n};\n\ntype optionProperty = \"url\" | \"el\";\n\n/**\n * 合并 preOptions 和 startOptions，并且将 url 和 el 变成可选\n */\nexport type cacheOptions = Omit<preOptions & startOptions, optionProperty> &\n  Partial<Pick<startOptions, optionProperty>>;\n\n/**\n * 强制中断主应用运行\n * wujie.__WUJIE 如果为true说明当前运行环境是子应用\n * window.__POWERED_BY_WUJIE__ 如果为false说明子应用还没初始化完成\n * 上述条件同时成立说明主应用代码在iframe的loading阶段混入进来了，必须中断执行\n */\nif (window.__WUJIE && !window.__POWERED_BY_WUJIE__) {\n  stopMainAppRun();\n}\n\n// 处理子应用链接跳转\nprocessAppForHrefJump();\n\n// 定义webComponent容器\ndefineWujieWebComponent();\n\n// 如果不支持则告警\nif (!wujieSupport) warn(WUJIE_TIPS_NOT_SUPPORTED);\n\n/**\n * 缓存子应用配置\n */\nexport function setupApp(options: cacheOptions): void {\n  if (options.name) addSandboxCacheWithOptions(options.name, options);\n}\n\n/**\n * 运行无界app\n */\nexport async function startApp(startOptions: startOptions): Promise<Function | void> {\n  const sandbox = getWujieById(startOptions.name);\n  const cacheOptions = getOptionsById(startOptions.name);\n  // 合并缓存配置\n  const options = mergeOptions(startOptions, cacheOptions);\n  const {\n    name,\n    url,\n    html,\n    replace,\n    fetch,\n    props,\n    attrs,\n    degradeAttrs,\n    fiber,\n    alive,\n    degrade,\n    sync,\n    prefix,\n    el,\n    loading,\n    plugins,\n    lifecycles,\n  } = options;\n  // 已经初始化过的应用，快速渲染\n  if (sandbox) {\n    sandbox.plugins = getPlugins(plugins);\n    sandbox.lifecycles = lifecycles;\n    const iframeWindow = sandbox.iframe.contentWindow;\n    if (sandbox.preload) {\n      await sandbox.preload;\n    }\n    if (alive) {\n      // 保活\n      await sandbox.active({ url, sync, prefix, el, props, alive, fetch, replace });\n      // 预加载但是没有执行的情况\n      if (!sandbox.execFlag) {\n        sandbox.lifecycles?.beforeLoad?.(sandbox.iframe.contentWindow);\n        const { getExternalScripts } = await importHTML({\n          url,\n          html,\n          opts: {\n            fetch: fetch || window.fetch,\n            plugins: sandbox.plugins,\n            loadError: sandbox.lifecycles.loadError,\n            fiber,\n          },\n        });\n        await sandbox.start(getExternalScripts);\n      }\n      sandbox.lifecycles?.activated?.(sandbox.iframe.contentWindow);\n      return sandbox.destroy;\n    } else if (isFunction(iframeWindow.__WUJIE_MOUNT)) {\n      /**\n       * 子应用切换会触发webcomponent的disconnectedCallback调用sandbox.unmount进行实例销毁\n       * 此处是防止没有销毁webcomponent时调用startApp的情况，需要手动调用unmount\n       */\n      sandbox.unmount();\n      await sandbox.active({ url, sync, prefix, el, props, alive, fetch, replace });\n      // 有渲染函数\n      sandbox.lifecycles?.beforeMount?.(sandbox.iframe.contentWindow);\n      iframeWindow.__WUJIE_MOUNT();\n      sandbox.lifecycles?.afterMount?.(sandbox.iframe.contentWindow);\n      sandbox.mountFlag = true;\n      sandbox.rebuildStyleSheets();\n      return sandbox.destroy;\n    } else {\n      // 没有渲染函数\n      sandbox.destroy();\n    }\n  }\n\n  // 设置loading\n  addLoading(el, loading);\n  const newSandbox = new WuJie({ name, url, attrs, degradeAttrs, fiber, degrade, plugins, lifecycles });\n  newSandbox.lifecycles?.beforeLoad?.(newSandbox.iframe.contentWindow);\n  const { template, getExternalScripts, getExternalStyleSheets } = await importHTML({\n    url,\n    html,\n    opts: {\n      fetch: fetch || window.fetch,\n      plugins: newSandbox.plugins,\n      loadError: newSandbox.lifecycles.loadError,\n      fiber,\n    },\n  });\n\n  const processedHtml = await processCssLoader(newSandbox, template, getExternalStyleSheets);\n  await newSandbox.active({ url, sync, prefix, template: processedHtml, el, props, alive, fetch, replace });\n  await newSandbox.start(getExternalScripts);\n  return newSandbox.destroy;\n}\n\n/**\n * 预加载无界APP\n */\nexport function preloadApp(preOptions: preOptions): void {\n  requestIdleCallback((): void | Promise<void> => {\n    /**\n     * 已经存在\n     * url查询参数中有子应用的id，大概率是刷新浏览器或者分享url，此时需要直接打开子应用，无需预加载\n     */\n    if (getWujieById(preOptions.name) || isMatchSyncQueryById(preOptions.name)) return;\n    const cacheOptions = getOptionsById(preOptions.name);\n    // 合并缓存配置\n    const options = mergeOptions({ ...preOptions }, cacheOptions);\n    const {\n      name,\n      url,\n      html,\n      props,\n      alive,\n      replace,\n      fetch,\n      exec,\n      attrs,\n      degradeAttrs,\n      fiber,\n      degrade,\n      prefix,\n      plugins,\n      lifecycles,\n    } = options;\n\n    const sandbox = new WuJie({ name, url, attrs, degradeAttrs, fiber, degrade, plugins, lifecycles });\n    if (sandbox.preload) return sandbox.preload;\n    const runPreload = async () => {\n      sandbox.lifecycles?.beforeLoad?.(sandbox.iframe.contentWindow);\n      const { template, getExternalScripts, getExternalStyleSheets } = await importHTML({\n        url,\n        html,\n        opts: {\n          fetch: fetch || window.fetch,\n          plugins: sandbox.plugins,\n          loadError: sandbox.lifecycles.loadError,\n          fiber,\n        },\n      });\n      const processedHtml = await processCssLoader(sandbox, template, getExternalStyleSheets);\n      await sandbox.active({ url, props, prefix, alive, template: processedHtml, fetch, replace });\n      if (exec) {\n        await sandbox.start(getExternalScripts);\n      } else {\n        await getExternalScripts();\n      }\n    };\n    sandbox.preload = runPreload();\n  });\n}\n\n/**\n * 销毁无界APP\n */\nexport function destroyApp(id: string): void {\n  const sandbox = getWujieById(id);\n  if (sandbox) {\n    sandbox.destroy();\n  }\n}\n"],"mappings":"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"}