{"version":3,"file":"entry.js","names":["processTpl","genLinkReplaceSymbol","getInlineStyleReplaceSymbol","defaultGetPublicPath","getInlineCode","requestIdleCallback","error","compose","getCurUrl","WUJIE_TIPS_NO_FETCH","WUJIE_TIPS_SCRIPT_ERROR_REQUESTED","WUJIE_TIPS_CSS_ERROR_REQUESTED","WUJIE_TIPS_HTML_ERROR_REQUESTED","getEffectLoaders","isMatchUrl","styleCache","scriptCache","embedHTMLCache","window","fetch","Error","defaultFetch","bind","defaultGetTemplate","tpl","processCssLoader","sandbox","template","getExternalStyleSheets","curUrl","proxyLocation","composeCssLoader","plugins","map","plugin","cssLoader","processedCssList","src","ignore","contentPromise","then","content","getEmbedHTML","embedHTML","replace","styleResultList","Promise","all","styleResult","index","isInlineCode","code","startsWith","fetchAssets","cache","cssFlag","loadError","response","status","text","e","styles","resolve","getExternalScripts","scripts","fiber","script","async","defer","module","reject","importHTML","params","url","opts","html","htmlLoader","jsExcludes","cssExcludes","jsIgnores","cssIgnores","getPublicPath","getHtmlParseResult","assetPublicPath","filter","style","some"],"sources":["../src/entry.ts"],"sourcesContent":["import processTpl, {\n  genLinkReplaceSymbol,\n  getInlineStyleReplaceSymbol,\n  ScriptObject,\n  ScriptBaseObject,\n  StyleObject,\n} from \"./template\";\nimport { defaultGetPublicPath, getInlineCode, requestIdleCallback, error, compose, getCurUrl } from \"./utils\";\nimport {\n  WUJIE_TIPS_NO_FETCH,\n  WUJIE_TIPS_SCRIPT_ERROR_REQUESTED,\n  WUJIE_TIPS_CSS_ERROR_REQUESTED,\n  WUJIE_TIPS_HTML_ERROR_REQUESTED,\n} from \"./constant\";\nimport { getEffectLoaders, isMatchUrl } from \"./plugin\";\nimport Wujie from \"./sandbox\";\nimport { plugin, loadErrorHandler } from \"./index\";\n\nexport type ScriptResultList = (ScriptBaseObject & { contentPromise: Promise<string> })[];\nexport type StyleResultList = { src: string; contentPromise: Promise<string>; ignore?: boolean }[];\n\ninterface htmlParseResult {\n  template: string;\n\n  assetPublicPath: string;\n\n  getExternalScripts(): ScriptResultList;\n\n  getExternalStyleSheets(): StyleResultList;\n}\n\ntype ImportEntryOpts = {\n  fetch?: typeof window.fetch;\n  fiber?: boolean;\n  plugins?: Array<plugin>;\n  loadError?: loadErrorHandler;\n};\n\nconst styleCache = {};\nconst scriptCache = {};\nconst embedHTMLCache = {};\n\nif (!window.fetch) {\n  error(WUJIE_TIPS_NO_FETCH);\n  throw new Error();\n}\nconst defaultFetch = window.fetch.bind(window);\n\nfunction defaultGetTemplate(tpl) {\n  return tpl;\n}\n\n/**\n * 处理css-loader\n */\nexport async function processCssLoader(\n  sandbox: Wujie,\n  template: string,\n  getExternalStyleSheets: () => StyleResultList\n): Promise<string> {\n  const curUrl = getCurUrl(sandbox.proxyLocation);\n  /** css-loader */\n  const composeCssLoader = compose(sandbox.plugins.map((plugin) => plugin.cssLoader));\n  const processedCssList: StyleResultList = getExternalStyleSheets().map(({ src, ignore, contentPromise }) => ({\n    src,\n    ignore,\n    contentPromise: contentPromise.then((content) => composeCssLoader(content, src, curUrl)),\n  }));\n  const embedHTML = await getEmbedHTML(template, processedCssList);\n  return sandbox.replace ? sandbox.replace(embedHTML) : embedHTML;\n}\n\n/**\n * convert external css link to inline style for performance optimization\n * @return embedHTML\n */\nasync function getEmbedHTML(template, styleResultList: StyleResultList): Promise<string> {\n  let embedHTML = template;\n\n  return Promise.all(\n    styleResultList.map((styleResult, index) =>\n      styleResult.contentPromise.then((content) => {\n        if (styleResult.src) {\n          embedHTML = embedHTML.replace(\n            genLinkReplaceSymbol(styleResult.src),\n            styleResult.ignore\n              ? `<link href=\"${styleResult.src}\" rel=\"stylesheet\" type=\"text/css\">`\n              : `<style>/* ${styleResult.src} */${content}</style>`\n          );\n        } else if (content) {\n          embedHTML = embedHTML.replace(\n            getInlineStyleReplaceSymbol(index),\n            `<style>/* inline-style-${index} */${content}</style>`\n          );\n        }\n      })\n    )\n  ).then(() => embedHTML);\n}\n\nconst isInlineCode = (code) => code.startsWith(\"<\");\n\nconst fetchAssets = (\n  src: string,\n  cache: Object,\n  fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response>,\n  cssFlag?: boolean,\n  loadError?: loadErrorHandler\n) =>\n  cache[src] ||\n  (cache[src] = fetch(src)\n    .then((response) => {\n      // usually browser treats 4xx and 5xx response of script loading as an error and will fire a script error event\n      // https://stackoverflow.com/questions/5625420/what-http-headers-responses-trigger-the-onerror-handler-on-a-script-tag/5625603\n      if (response.status >= 400) {\n        cache[src] = null;\n        if (cssFlag) {\n          error(WUJIE_TIPS_CSS_ERROR_REQUESTED, { src, response });\n          loadError?.(src, new Error(WUJIE_TIPS_CSS_ERROR_REQUESTED));\n          return \"\";\n        } else {\n          error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED, { src, response });\n          loadError?.(src, new Error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED));\n          throw new Error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED);\n        }\n      }\n      return response.text();\n    })\n    .catch((e) => {\n      cache[src] = null;\n      if (cssFlag) {\n        error(WUJIE_TIPS_CSS_ERROR_REQUESTED, src);\n        loadError?.(src, e);\n        return \"\";\n      } else {\n        error(WUJIE_TIPS_SCRIPT_ERROR_REQUESTED, src);\n        loadError?.(src, e);\n        return \"\";\n      }\n    }));\n\n// for prefetch\nexport function getExternalStyleSheets(\n  styles: StyleObject[],\n  fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response> = defaultFetch,\n  loadError: loadErrorHandler\n): StyleResultList {\n  return styles.map(({ src, content, ignore }) => {\n    // 内联\n    if (content) {\n      return { src: \"\", contentPromise: Promise.resolve(content) };\n    } else if (isInlineCode(src)) {\n      // if it is inline style\n      return { src: \"\", contentPromise: Promise.resolve(getInlineCode(src)) };\n    } else {\n      // external styles\n      return {\n        src,\n        ignore,\n        contentPromise: ignore ? Promise.resolve(\"\") : fetchAssets(src, styleCache, fetch, true, loadError),\n      };\n    }\n  });\n}\n\n// for prefetch\nexport function getExternalScripts(\n  scripts: ScriptObject[],\n  fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response> = defaultFetch,\n  loadError: loadErrorHandler,\n  fiber: boolean\n): ScriptResultList {\n  // module should be requested in iframe\n  return scripts.map((script) => {\n    const { src, async, defer, module, ignore } = script;\n    let contentPromise = null;\n    // async\n    if ((async || defer) && src && !module) {\n      contentPromise = new Promise((resolve, reject) =>\n        fiber\n          ? requestIdleCallback(() => fetchAssets(src, scriptCache, fetch, false, loadError).then(resolve, reject))\n          : fetchAssets(src, scriptCache, fetch, false, loadError).then(resolve, reject)\n      );\n      // module || ignore\n    } else if ((module && src) || ignore) {\n      contentPromise = Promise.resolve(\"\");\n      // inline\n    } else if (!src) {\n      contentPromise = Promise.resolve(script.content);\n      // outline\n    } else {\n      contentPromise = fetchAssets(src, scriptCache, fetch, false, loadError);\n    }\n    // refer https://html.spec.whatwg.org/multipage/scripting.html#attr-script-defer\n    if (module && !async) script.defer = true;\n    return { ...script, contentPromise };\n  });\n}\n\nexport default function importHTML(params: {\n  url: string;\n  html?: string;\n  opts: ImportEntryOpts;\n}): Promise<htmlParseResult> {\n  const { url, opts, html } = params;\n  const fetch = opts.fetch ?? defaultFetch;\n  const fiber = opts.fiber ?? true;\n  const { plugins, loadError } = opts;\n  const htmlLoader = plugins ? compose(plugins.map((plugin) => plugin.htmlLoader)) : defaultGetTemplate;\n  const jsExcludes = getEffectLoaders(\"jsExcludes\", plugins);\n  const cssExcludes = getEffectLoaders(\"cssExcludes\", plugins);\n  const jsIgnores = getEffectLoaders(\"jsIgnores\", plugins);\n  const cssIgnores = getEffectLoaders(\"cssIgnores\", plugins);\n  const getPublicPath = defaultGetPublicPath;\n\n  const getHtmlParseResult = (url, html, htmlLoader) =>\n    (html\n      ? Promise.resolve(html)\n      : fetch(url)\n          .then((response) => {\n            if (response.status >= 400) {\n              error(WUJIE_TIPS_HTML_ERROR_REQUESTED, { url, response });\n              loadError?.(url, new Error(WUJIE_TIPS_HTML_ERROR_REQUESTED));\n              return \"\";\n            }\n            return response.text();\n          })\n          .catch((e) => {\n            embedHTMLCache[url] = null;\n            loadError?.(url, e);\n            return Promise.reject(e);\n          })\n    ).then((html) => {\n      const assetPublicPath = getPublicPath(url);\n      const { template, scripts, styles } = processTpl(htmlLoader(html), assetPublicPath);\n      return {\n        template: template,\n        assetPublicPath,\n        getExternalScripts: () =>\n          getExternalScripts(\n            scripts\n              .filter((script) => !script.src || !isMatchUrl(script.src, jsExcludes))\n              .map((script) => ({ ...script, ignore: script.src && isMatchUrl(script.src, jsIgnores) })),\n            fetch,\n            loadError,\n            fiber\n          ),\n        getExternalStyleSheets: () =>\n          getExternalStyleSheets(\n            styles\n              .filter((style) => !style.src || !isMatchUrl(style.src, cssExcludes))\n              .map((style) => ({ ...style, ignore: style.src && isMatchUrl(style.src, cssIgnores) })),\n            fetch,\n            loadError\n          ),\n      };\n    });\n\n  if (opts?.plugins.some((plugin) => plugin.htmlLoader)) {\n    return getHtmlParseResult(url, html, htmlLoader);\n    // 没有html-loader可以做缓存\n  } else {\n    return embedHTMLCache[url] || (embedHTMLCache[url] = getHtmlParseResult(url, html, htmlLoader));\n  }\n}\n"],"mappings":";;;;;;;;AAAA,OAAOA,UAAP,IACEC,oBADF,EAEEC,2BAFF,QAMO,YANP;AAOA,SAASC,oBAAT,EAA+BC,aAA/B,EAA8CC,mBAA9C,EAAmEC,KAAnE,EAA0EC,OAA1E,EAAmFC,SAAnF,QAAoG,SAApG;AACA,SACEC,mBADF,EAEEC,iCAFF,EAGEC,8BAHF,EAIEC,+BAJF,QAKO,YALP;AAMA,SAASC,gBAAT,EAA2BC,UAA3B,QAA6C,UAA7C;AAwBA,IAAMC,UAAU,GAAG,EAAnB;AACA,IAAMC,WAAW,GAAG,EAApB;AACA,IAAMC,cAAc,GAAG,EAAvB;;AAEA,IAAI,CAACC,MAAM,CAACC,KAAZ,EAAmB;EACjBb,KAAK,CAACG,mBAAD,CAAL;EACA,MAAM,IAAIW,KAAJ,EAAN;AACD;;AACD,IAAMC,YAAY,GAAGH,MAAM,CAACC,KAAP,CAAaG,IAAb,CAAkBJ,MAAlB,CAArB;;AAEA,SAASK,kBAAT,CAA4BC,GAA5B,EAAiC;EAC/B,OAAOA,GAAP;AACD;AAED;AACA;AACA;;;AACA,gBAAsBC,gBAAtB;EAAA;AAAA;AAiBA;AACA;AACA;AACA;;;+EApBO,iBACLC,OADK,EAELC,QAFK,EAGLC,sBAHK;IAAA;IAAA;MAAA;QAAA;UAAA;YAKCC,MALD,GAKUrB,SAAS,CAACkB,OAAO,CAACI,aAAT,CALnB;YAML;;YACMC,gBAPD,GAOoBxB,OAAO,CAACmB,OAAO,CAACM,OAAR,CAAgBC,GAAhB,CAAoB,UAACC,MAAD;cAAA,OAAYA,MAAM,CAACC,SAAnB;YAAA,CAApB,CAAD,CAP3B;YAQCC,gBARD,GAQqCR,sBAAsB,GAAGK,GAAzB,CAA6B;cAAA,IAAGI,GAAH,SAAGA,GAAH;cAAA,IAAQC,MAAR,SAAQA,MAAR;cAAA,IAAgBC,cAAhB,SAAgBA,cAAhB;cAAA,OAAsC;gBAC3GF,GAAG,EAAHA,GAD2G;gBAE3GC,MAAM,EAANA,MAF2G;gBAG3GC,cAAc,EAAEA,cAAc,CAACC,IAAf,CAAoB,UAACC,OAAD;kBAAA,OAAaV,gBAAgB,CAACU,OAAD,EAAUJ,GAAV,EAAeR,MAAf,CAA7B;gBAAA,CAApB;cAH2F,CAAtC;YAAA,CAA7B,CARrC;YAAA;YAAA,OAamBa,YAAY,CAACf,QAAD,EAAWS,gBAAX,CAb/B;;UAAA;YAaCO,SAbD;YAAA,iCAcEjB,OAAO,CAACkB,OAAR,GAAkBlB,OAAO,CAACkB,OAAR,CAAgBD,SAAhB,CAAlB,GAA+CA,SAdjD;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,C;;;;SAqBQD,Y;;;;;2EAAf,kBAA4Bf,QAA5B,EAAsCkB,eAAtC;IAAA;IAAA;MAAA;QAAA;UAAA;YACMF,SADN,GACkBhB,QADlB;YAAA,kCAGSmB,OAAO,CAACC,GAAR,CACLF,eAAe,CAACZ,GAAhB,CAAoB,UAACe,WAAD,EAAcC,KAAd;cAAA,OAClBD,WAAW,CAACT,cAAZ,CAA2BC,IAA3B,CAAgC,UAACC,OAAD,EAAa;gBAC3C,IAAIO,WAAW,CAACX,GAAhB,EAAqB;kBACnBM,SAAS,GAAGA,SAAS,CAACC,OAAV,CACV3C,oBAAoB,CAAC+C,WAAW,CAACX,GAAb,CADV,EAEVW,WAAW,CAACV,MAAZ,0BACmBU,WAAW,CAACX,GAD/B,oEAEiBW,WAAW,CAACX,GAF7B,gBAEsCI,OAFtC,aAFU,CAAZ;gBAMD,CAPD,MAOO,IAAIA,OAAJ,EAAa;kBAClBE,SAAS,GAAGA,SAAS,CAACC,OAAV,CACV1C,2BAA2B,CAAC+C,KAAD,CADjB,mCAEgBA,KAFhB,gBAE2BR,OAF3B,cAAZ;gBAID;cACF,CAdD,CADkB;YAAA,CAApB,CADK,EAkBLD,IAlBK,CAkBA;cAAA,OAAMG,SAAN;YAAA,CAlBA,CAHT;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,C;;;;AAwBA,IAAMO,YAAY,GAAG,SAAfA,YAAe,CAACC,IAAD;EAAA,OAAUA,IAAI,CAACC,UAAL,CAAgB,GAAhB,CAAV;AAAA,CAArB;;AAEA,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAClBhB,GADkB,EAElBiB,KAFkB,EAGlBnC,KAHkB,EAIlBoC,OAJkB,EAKlBC,SALkB;EAAA,OAOlBF,KAAK,CAACjB,GAAD,CAAL,KACCiB,KAAK,CAACjB,GAAD,CAAL,GAAalB,KAAK,CAACkB,GAAD,CAAL,CACXG,IADW,CACN,UAACiB,QAAD,EAAc;IAClB;IACA;IACA,IAAIA,QAAQ,CAACC,MAAT,IAAmB,GAAvB,EAA4B;MAC1BJ,KAAK,CAACjB,GAAD,CAAL,GAAa,IAAb;;MACA,IAAIkB,OAAJ,EAAa;QACXjD,KAAK,CAACK,8BAAD,EAAiC;UAAE0B,GAAG,EAAHA,GAAF;UAAOoB,QAAQ,EAARA;QAAP,CAAjC,CAAL;QACAD,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAGnB,GAAH,EAAQ,IAAIjB,KAAJ,CAAUT,8BAAV,CAAR,CAAT;QACA,OAAO,EAAP;MACD,CAJD,MAIO;QACLL,KAAK,CAACI,iCAAD,EAAoC;UAAE2B,GAAG,EAAHA,GAAF;UAAOoB,QAAQ,EAARA;QAAP,CAApC,CAAL;QACAD,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAGnB,GAAH,EAAQ,IAAIjB,KAAJ,CAAUV,iCAAV,CAAR,CAAT;QACA,MAAM,IAAIU,KAAJ,CAAUV,iCAAV,CAAN;MACD;IACF;;IACD,OAAO+C,QAAQ,CAACE,IAAT,EAAP;EACD,CAjBW,WAkBL,UAACC,CAAD,EAAO;IACZN,KAAK,CAACjB,GAAD,CAAL,GAAa,IAAb;;IACA,IAAIkB,OAAJ,EAAa;MACXjD,KAAK,CAACK,8BAAD,EAAiC0B,GAAjC,CAAL;MACAmB,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAGnB,GAAH,EAAQuB,CAAR,CAAT;MACA,OAAO,EAAP;IACD,CAJD,MAIO;MACLtD,KAAK,CAACI,iCAAD,EAAoC2B,GAApC,CAAL;MACAmB,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAGnB,GAAH,EAAQuB,CAAR,CAAT;MACA,OAAO,EAAP;IACD;EACF,CA7BW,CADd,CAPkB;AAAA,CAApB,C,CAuCA;;;AACO,SAAShC,uBAAT,CACLiC,MADK,EAIY;EAAA,IAFjB1C,KAEiB,uEAFsDE,YAEtD;EAAA,IADjBmC,SACiB;EACjB,OAAOK,MAAM,CAAC5B,GAAP,CAAW,gBAA8B;IAAA,IAA3BI,GAA2B,QAA3BA,GAA2B;IAAA,IAAtBI,OAAsB,QAAtBA,OAAsB;IAAA,IAAbH,MAAa,QAAbA,MAAa;;IAC9C;IACA,IAAIG,OAAJ,EAAa;MACX,OAAO;QAAEJ,GAAG,EAAE,EAAP;QAAWE,cAAc,EAAEO,OAAO,CAACgB,OAAR,CAAgBrB,OAAhB;MAA3B,CAAP;IACD,CAFD,MAEO,IAAIS,YAAY,CAACb,GAAD,CAAhB,EAAuB;MAC5B;MACA,OAAO;QAAEA,GAAG,EAAE,EAAP;QAAWE,cAAc,EAAEO,OAAO,CAACgB,OAAR,CAAgB1D,aAAa,CAACiC,GAAD,CAA7B;MAA3B,CAAP;IACD,CAHM,MAGA;MACL;MACA,OAAO;QACLA,GAAG,EAAHA,GADK;QAELC,MAAM,EAANA,MAFK;QAGLC,cAAc,EAAED,MAAM,GAAGQ,OAAO,CAACgB,OAAR,CAAgB,EAAhB,CAAH,GAAyBT,WAAW,CAAChB,GAAD,EAAMtB,UAAN,EAAkBI,KAAlB,EAAyB,IAAzB,EAA+BqC,SAA/B;MAHrD,CAAP;IAKD;EACF,CAfM,CAAP;AAgBD,C,CAED;;;;;AACO,SAASO,mBAAT,CACLC,OADK,EAKa;EAAA,IAHlB7C,KAGkB,uEAHqDE,YAGrD;EAAA,IAFlBmC,SAEkB;EAAA,IADlBS,KACkB;EAClB;EACA,OAAOD,OAAO,CAAC/B,GAAR,CAAY,UAACiC,MAAD,EAAY;IAC7B,IAAQ7B,GAAR,GAA8C6B,MAA9C,CAAQ7B,GAAR;IAAA,IAAa8B,KAAb,GAA8CD,MAA9C,CAAaC,KAAb;IAAA,IAAoBC,KAApB,GAA8CF,MAA9C,CAAoBE,KAApB;IAAA,IAA2BC,MAA3B,GAA8CH,MAA9C,CAA2BG,MAA3B;IAAA,IAAmC/B,MAAnC,GAA8C4B,MAA9C,CAAmC5B,MAAnC;IACA,IAAIC,cAAc,GAAG,IAArB,CAF6B,CAG7B;;IACA,IAAI,CAAC4B,KAAK,IAAIC,KAAV,KAAoB/B,GAApB,IAA2B,CAACgC,MAAhC,EAAwC;MACtC9B,cAAc,GAAG,IAAIO,OAAJ,CAAY,UAACgB,OAAD,EAAUQ,MAAV;QAAA,OAC3BL,KAAK,GACD5D,mBAAmB,CAAC;UAAA,OAAMgD,WAAW,CAAChB,GAAD,EAAMrB,WAAN,EAAmBG,KAAnB,EAA0B,KAA1B,EAAiCqC,SAAjC,CAAX,CAAuDhB,IAAvD,CAA4DsB,OAA5D,EAAqEQ,MAArE,CAAN;QAAA,CAAD,CADlB,GAEDjB,WAAW,CAAChB,GAAD,EAAMrB,WAAN,EAAmBG,KAAnB,EAA0B,KAA1B,EAAiCqC,SAAjC,CAAX,CAAuDhB,IAAvD,CAA4DsB,OAA5D,EAAqEQ,MAArE,CAHuB;MAAA,CAAZ,CAAjB,CADsC,CAMtC;IACD,CAPD,MAOO,IAAKD,MAAM,IAAIhC,GAAX,IAAmBC,MAAvB,EAA+B;MACpCC,cAAc,GAAGO,OAAO,CAACgB,OAAR,CAAgB,EAAhB,CAAjB,CADoC,CAEpC;IACD,CAHM,MAGA,IAAI,CAACzB,GAAL,EAAU;MACfE,cAAc,GAAGO,OAAO,CAACgB,OAAR,CAAgBI,MAAM,CAACzB,OAAvB,CAAjB,CADe,CAEf;IACD,CAHM,MAGA;MACLF,cAAc,GAAGc,WAAW,CAAChB,GAAD,EAAMrB,WAAN,EAAmBG,KAAnB,EAA0B,KAA1B,EAAiCqC,SAAjC,CAA5B;IACD,CAnB4B,CAoB7B;;;IACA,IAAIa,MAAM,IAAI,CAACF,KAAf,EAAsBD,MAAM,CAACE,KAAP,GAAe,IAAf;IACtB,uCAAYF,MAAZ;MAAoB3B,cAAc,EAAdA;IAApB;EACD,CAvBM,CAAP;AAwBD;;;AAED,eAAe,SAASgC,UAAT,CAAoBC,MAApB,EAIc;EAAA;;EAC3B,IAAQC,GAAR,GAA4BD,MAA5B,CAAQC,GAAR;EAAA,IAAaC,IAAb,GAA4BF,MAA5B,CAAaE,IAAb;EAAA,IAAmBC,IAAnB,GAA4BH,MAA5B,CAAmBG,IAAnB;EACA,IAAMxD,KAAK,kBAAGuD,IAAI,CAACvD,KAAR,qDAAiBE,YAA5B;EACA,IAAM4C,KAAK,kBAAGS,IAAI,CAACT,KAAR,qDAAiB,IAA5B;EACA,IAAQjC,OAAR,GAA+B0C,IAA/B,CAAQ1C,OAAR;EAAA,IAAiBwB,SAAjB,GAA+BkB,IAA/B,CAAiBlB,SAAjB;EACA,IAAMoB,UAAU,GAAG5C,OAAO,GAAGzB,OAAO,CAACyB,OAAO,CAACC,GAAR,CAAY,UAACC,MAAD;IAAA,OAAYA,MAAM,CAAC0C,UAAnB;EAAA,CAAZ,CAAD,CAAV,GAAyDrD,kBAAnF;EACA,IAAMsD,UAAU,GAAGhE,gBAAgB,CAAC,YAAD,EAAemB,OAAf,CAAnC;EACA,IAAM8C,WAAW,GAAGjE,gBAAgB,CAAC,aAAD,EAAgBmB,OAAhB,CAApC;EACA,IAAM+C,SAAS,GAAGlE,gBAAgB,CAAC,WAAD,EAAcmB,OAAd,CAAlC;EACA,IAAMgD,UAAU,GAAGnE,gBAAgB,CAAC,YAAD,EAAemB,OAAf,CAAnC;EACA,IAAMiD,aAAa,GAAG9E,oBAAtB;;EAEA,IAAM+E,kBAAkB,GAAG,SAArBA,kBAAqB,CAACT,GAAD,EAAME,IAAN,EAAYC,UAAZ;IAAA,OACzB,CAACD,IAAI,GACD7B,OAAO,CAACgB,OAAR,CAAgBa,IAAhB,CADC,GAEDxD,KAAK,CAACsD,GAAD,CAAL,CACGjC,IADH,CACQ,UAACiB,QAAD,EAAc;MAClB,IAAIA,QAAQ,CAACC,MAAT,IAAmB,GAAvB,EAA4B;QAC1BpD,KAAK,CAACM,+BAAD,EAAkC;UAAE6D,GAAG,EAAHA,GAAF;UAAOhB,QAAQ,EAARA;QAAP,CAAlC,CAAL;QACAD,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAGiB,GAAH,EAAQ,IAAIrD,KAAJ,CAAUR,+BAAV,CAAR,CAAT;QACA,OAAO,EAAP;MACD;;MACD,OAAO6C,QAAQ,CAACE,IAAT,EAAP;IACD,CARH,WASS,UAACC,CAAD,EAAO;MACZ3C,cAAc,CAACwD,GAAD,CAAd,GAAsB,IAAtB;MACAjB,SAAS,SAAT,IAAAA,SAAS,WAAT,YAAAA,SAAS,CAAGiB,GAAH,EAAQb,CAAR,CAAT;MACA,OAAOd,OAAO,CAACwB,MAAR,CAAeV,CAAf,CAAP;IACD,CAbH,CAFJ,EAgBEpB,IAhBF,CAgBO,UAACmC,IAAD,EAAU;MACf,IAAMQ,eAAe,GAAGF,aAAa,CAACR,GAAD,CAArC;;MACA,kBAAsCzE,UAAU,CAAC4E,UAAU,CAACD,IAAD,CAAX,EAAmBQ,eAAnB,CAAhD;MAAA,IAAQxD,QAAR,eAAQA,QAAR;MAAA,IAAkBqC,OAAlB,eAAkBA,OAAlB;MAAA,IAA2BH,MAA3B,eAA2BA,MAA3B;;MACA,OAAO;QACLlC,QAAQ,EAAEA,QADL;QAELwD,eAAe,EAAfA,eAFK;QAGLpB,kBAAkB,EAAE;UAAA,OAClBA,mBAAkB,CAChBC,OAAO,CACJoB,MADH,CACU,UAAClB,MAAD;YAAA,OAAY,CAACA,MAAM,CAAC7B,GAAR,IAAe,CAACvB,UAAU,CAACoD,MAAM,CAAC7B,GAAR,EAAawC,UAAb,CAAtC;UAAA,CADV,EAEG5C,GAFH,CAEO,UAACiC,MAAD;YAAA,uCAAkBA,MAAlB;cAA0B5B,MAAM,EAAE4B,MAAM,CAAC7B,GAAP,IAAcvB,UAAU,CAACoD,MAAM,CAAC7B,GAAR,EAAa0C,SAAb;YAA1D;UAAA,CAFP,CADgB,EAIhB5D,KAJgB,EAKhBqC,SALgB,EAMhBS,KANgB,CADA;QAAA,CAHf;QAYLrC,sBAAsB,EAAE;UAAA,OACtBA,uBAAsB,CACpBiC,MAAM,CACHuB,MADH,CACU,UAACC,KAAD;YAAA,OAAW,CAACA,KAAK,CAAChD,GAAP,IAAc,CAACvB,UAAU,CAACuE,KAAK,CAAChD,GAAP,EAAYyC,WAAZ,CAApC;UAAA,CADV,EAEG7C,GAFH,CAEO,UAACoD,KAAD;YAAA,uCAAiBA,KAAjB;cAAwB/C,MAAM,EAAE+C,KAAK,CAAChD,GAAN,IAAavB,UAAU,CAACuE,KAAK,CAAChD,GAAP,EAAY2C,UAAZ;YAAvD;UAAA,CAFP,CADoB,EAIpB7D,KAJoB,EAKpBqC,SALoB,CADA;QAAA;MAZnB,CAAP;IAqBD,CAxCD,CADyB;EAAA,CAA3B;;EA2CA,IAAIkB,IAAJ,aAAIA,IAAJ,eAAIA,IAAI,CAAE1C,OAAN,CAAcsD,IAAd,CAAmB,UAACpD,MAAD;IAAA,OAAYA,MAAM,CAAC0C,UAAnB;EAAA,CAAnB,CAAJ,EAAuD;IACrD,OAAOM,kBAAkB,CAACT,GAAD,EAAME,IAAN,EAAYC,UAAZ,CAAzB,CADqD,CAErD;EACD,CAHD,MAGO;IACL,OAAO3D,cAAc,CAACwD,GAAD,CAAd,KAAwBxD,cAAc,CAACwD,GAAD,CAAd,GAAsBS,kBAAkB,CAACT,GAAD,EAAME,IAAN,EAAYC,UAAZ,CAAhE,CAAP;EACD;AACF"}