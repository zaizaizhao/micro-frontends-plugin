{"version":3,"file":"utils.js","names":["WUJIE_SCRIPT_ID","WUJIE_TIPS_NO_URL","WUJIE_APP_ID","WUJIE_TIPS_STOP_APP","WUJIE_TIPS_STOP_APP_DETAIL","toArray","array","Array","isArray","isFunction","value","isHijackingTag","tagName","toUpperCase","wujieSupport","window","Proxy","CustomElementRegistry","naughtySafari","document","all","callableFnCacheMap","WeakMap","isCallable","fn","has","callable","set","boundedMap","isBoundedFunction","get","bounded","name","indexOf","hasOwnProperty","fnRegexCheckCacheMap","isConstructable","hasPrototypeMethods","prototype","constructor","Object","getOwnPropertyNames","length","constructable","fnString","toString","constructableFunctionRegex","classRegex","test","setFnCacheMap","checkProxyFunction","getTargetValue","target","p","boundValue","Function","bind","call","key","defineProperty","enumerable","writable","getDegradeIframe","id","querySelector","setAttrsToElement","element","attrs","keys","forEach","setAttribute","appRouteParse","url","error","Error","urlElement","anchorElementGenerator","appHostPath","protocol","host","appRoutePath","pathname","search","hash","startsWith","createElement","href","getAnchorElementQueryMap","anchorElement","queryList","replace","split","queryMap","query","isMatchSyncQueryById","location","includes","fixElementCtrSrcOrHref","iframeWindow","elementCtr","attr","rawElementSetAttribute","Element","targetValue","getAbsolutePath","baseURI","rawAnchorElementHrefDescriptor","getOwnPropertyDescriptor","configurable","getCurUrl","proxyLocation","base","URL","getSyncUrl","prefix","winUrlElement","syncUrl","decodeURIComponent","validShortPath","match","requestIdleCallback","cb","setTimeout","getContainer","container","warn","msg","data","console","getInlineCode","start","end","lastIndexOf","substring","defaultGetPublicPath","entry","origin","paths","pop","join","e","compose","fnList","code","args","reduce","newCode","nextTick","Promise","resolve","then","execHooks","plugins","hookName","map","plugin","filter","hook","isScriptElement","count","setTagToScript","tag","scriptTag","String","getTagFromScript","getAttribute","mergeOptions","options","cacheOptions","el","html","exec","undefined","fetch","props","sync","loading","degradeAttrs","fiber","alive","degrade","lifecycles","beforeLoad","beforeMount","afterMount","beforeUnmount","afterUnmount","activated","deactivated","loadError","eventTrigger","eventName","detail","event","CustomEvent","createEvent","initCustomEvent","dispatchEvent","stopMainAppRun"],"sources":["../src/utils.ts"],"sourcesContent":["import {\n  WUJIE_SCRIPT_ID,\n  WUJIE_TIPS_NO_URL,\n  WUJIE_APP_ID,\n  WUJIE_TIPS_STOP_APP,\n  WUJIE_TIPS_STOP_APP_DETAIL,\n} from \"./constant\";\nimport { plugin, cacheOptions } from \"./index\";\n\nexport function toArray<T>(array: T | T[]): T[] {\n  return Array.isArray(array) ? array : [array];\n}\n\nexport function isFunction(value: any): boolean {\n  return typeof value === \"function\";\n}\n\nexport function isHijackingTag(tagName?: string) {\n  return (\n    tagName?.toUpperCase() === \"LINK\" ||\n    tagName?.toUpperCase() === \"STYLE\" ||\n    tagName?.toUpperCase() === \"SCRIPT\" ||\n    tagName?.toUpperCase() === \"IFRAME\"\n  );\n}\n\nexport const wujieSupport = window.Proxy && window.CustomElementRegistry;\n\n/**\n * in safari\n * typeof document.all === 'undefined' // true\n * typeof document.all === 'function' // true\n * We need to discriminate safari for better performance\n */\nconst naughtySafari = typeof document.all === \"function\" && typeof document.all === \"undefined\";\nconst callableFnCacheMap = new WeakMap<CallableFunction, boolean>();\nexport const isCallable = (fn: any) => {\n  if (callableFnCacheMap.has(fn)) {\n    return true;\n  }\n\n  const callable = naughtySafari ? typeof fn === \"function\" && typeof fn !== \"undefined\" : typeof fn === \"function\";\n  if (callable) {\n    callableFnCacheMap.set(fn, callable);\n  }\n  return callable;\n};\n\nconst boundedMap = new WeakMap<CallableFunction, boolean>();\nexport function isBoundedFunction(fn: CallableFunction) {\n  if (boundedMap.has(fn)) {\n    return boundedMap.get(fn);\n  }\n  const bounded = fn.name.indexOf(\"bound \") === 0 && !fn.hasOwnProperty(\"prototype\");\n  boundedMap.set(fn, bounded);\n  return bounded;\n}\n\nconst fnRegexCheckCacheMap = new WeakMap<any | FunctionConstructor, boolean>();\nexport function isConstructable(fn: () => any | FunctionConstructor) {\n  const hasPrototypeMethods =\n    fn.prototype && fn.prototype.constructor === fn && Object.getOwnPropertyNames(fn.prototype).length > 1;\n\n  if (hasPrototypeMethods) return true;\n\n  if (fnRegexCheckCacheMap.has(fn)) {\n    return fnRegexCheckCacheMap.get(fn);\n  }\n\n  let constructable = hasPrototypeMethods;\n  if (!constructable) {\n    const fnString = fn.toString();\n    const constructableFunctionRegex = /^function\\b\\s[A-Z].*/;\n    const classRegex = /^class\\b/;\n    constructable = constructableFunctionRegex.test(fnString) || classRegex.test(fnString);\n  }\n\n  fnRegexCheckCacheMap.set(fn, constructable);\n  return constructable;\n}\n\nconst setFnCacheMap = new WeakMap<CallableFunction, CallableFunction>();\nexport function checkProxyFunction(value: any) {\n  if (isCallable(value) && !isBoundedFunction(value) && !isConstructable(value)) {\n    if (!setFnCacheMap.has(value)) {\n      setFnCacheMap.set(value, value);\n    }\n  }\n}\n\nexport function getTargetValue(target: any, p: any): any {\n  const value = target[p];\n  if (setFnCacheMap.has(value)) {\n    return setFnCacheMap.get(value);\n  }\n  if (isCallable(value) && !isBoundedFunction(value) && !isConstructable(value)) {\n    const boundValue = Function.prototype.bind.call(value, target);\n    setFnCacheMap.set(value, boundValue);\n\n    for (const key in value) {\n      boundValue[key] = value[key];\n    }\n    if (value.hasOwnProperty(\"prototype\") && !boundValue.hasOwnProperty(\"prototype\")) {\n      // https://github.com/kuitos/kuitos.github.io/issues/47\n      Object.defineProperty(boundValue, \"prototype\", { value: value.prototype, enumerable: false, writable: true });\n    }\n    return boundValue;\n  }\n  return value;\n}\n\nexport function getDegradeIframe(id: string): HTMLIFrameElement {\n  return window.document.querySelector(`iframe[${WUJIE_APP_ID}=\"${id}\"]`);\n}\n\nexport function setAttrsToElement(element: HTMLElement, attrs: { [key: string]: any }) {\n  Object.keys(attrs).forEach((name) => {\n    element.setAttribute(name, attrs[name]);\n  });\n}\n\nexport function appRouteParse(url: string): {\n  urlElement: HTMLAnchorElement;\n  appHostPath: string;\n  appRoutePath: string;\n} {\n  if (!url) {\n    error(WUJIE_TIPS_NO_URL);\n    throw new Error();\n  }\n  const urlElement = anchorElementGenerator(url);\n  const appHostPath = urlElement.protocol + \"//\" + urlElement.host;\n  let appRoutePath = urlElement.pathname + urlElement.search + urlElement.hash;\n  if (!appRoutePath.startsWith(\"/\")) appRoutePath = \"/\" + appRoutePath; // hack ie\n  return { urlElement, appHostPath, appRoutePath };\n}\n\nexport function anchorElementGenerator(url: string): HTMLAnchorElement {\n  const element = window.document.createElement(\"a\");\n  element.href = url;\n  element.href = element.href; // hack ie\n  return element;\n}\n\nexport function getAnchorElementQueryMap(anchorElement: HTMLAnchorElement): { [key: string]: string } {\n  const queryList = anchorElement.search.replace(\"?\", \"\").split(\"&\");\n  const queryMap = {};\n  queryList.forEach((query) => {\n    const [key, value] = query.split(\"=\");\n    if (key && value) queryMap[key] = value;\n  });\n  return queryMap;\n}\n\n/**\n * 当前url的查询参数中是否有给定的id\n */\nexport function isMatchSyncQueryById(id: string): boolean {\n  const queryMap = getAnchorElementQueryMap(anchorElementGenerator(window.location.href));\n  return Object.keys(queryMap).includes(id);\n}\n\n/**\n * 劫持元素原型对相对地址的赋值转绝对地址\n * @param iframeWindow\n */\nexport function fixElementCtrSrcOrHref(\n  iframeWindow: Window,\n  elementCtr:\n    | typeof HTMLImageElement\n    | typeof HTMLAnchorElement\n    | typeof HTMLSourceElement\n    | typeof HTMLLinkElement\n    | typeof HTMLScriptElement\n    | typeof HTMLMediaElement,\n  attr\n): void {\n  // patch setAttribute\n  const rawElementSetAttribute = iframeWindow.Element.prototype.setAttribute;\n  elementCtr.prototype.setAttribute = function (name: string, value: string): void {\n    let targetValue = value;\n    if (name === attr) targetValue = getAbsolutePath(value, this.baseURI || \"\", true);\n    rawElementSetAttribute.call(this, name, targetValue);\n  };\n  // patch href get and set\n  const rawAnchorElementHrefDescriptor = Object.getOwnPropertyDescriptor(elementCtr.prototype, attr);\n  const { enumerable, configurable, get, set } = rawAnchorElementHrefDescriptor;\n  Object.defineProperty(elementCtr.prototype, attr, {\n    enumerable,\n    configurable,\n    get: function () {\n      return get.call(this);\n    },\n    set: function (href) {\n      set.call(this, getAbsolutePath(href, this.baseURI, true));\n    },\n  });\n  // TODO: innerHTML的处理\n}\n\nexport function getCurUrl(proxyLocation: Object): string {\n  const location = proxyLocation as Location;\n  return location.protocol + \"//\" + location.host + location.pathname;\n}\n\nexport function getAbsolutePath(url: string, base: string, hash?: boolean): string {\n  try {\n    // 为空值无需处理\n    if (url) {\n      // 需要处理hash的场景\n      if (hash && url.startsWith(\"#\")) return url;\n      return new URL(url, base).href;\n    } else return url;\n  } catch {\n    return url;\n  }\n}\n/**\n * 获取需要同步的url\n */\nexport function getSyncUrl(id: string, prefix: { [key: string]: string }): string {\n  let winUrlElement = anchorElementGenerator(window.location.href);\n  const queryMap = getAnchorElementQueryMap(winUrlElement);\n  winUrlElement = null;\n  const syncUrl = window.decodeURIComponent(queryMap[id] || \"\");\n  const validShortPath = syncUrl.match(/^{([^}]*)}/)?.[1];\n  if (prefix && validShortPath) {\n    return syncUrl.replace(`{${validShortPath}}`, prefix[validShortPath]);\n  }\n  return syncUrl;\n}\n// @ts-ignore\nexport const requestIdleCallback = window.requestIdleCallback || ((cb: Function) => setTimeout(cb, 1));\n\nexport function getContainer(container: string | HTMLElement): HTMLElement {\n  return typeof container === \"string\" ? (document.querySelector(container) as HTMLElement) : container;\n}\n\nexport function warn(msg: string, data?: any): void {\n  console?.warn(`[wujie warn]: ${msg}`, data);\n}\n\nexport function error(msg: string, data?: any): void {\n  console?.error(`[wujie error]: ${msg}`, data);\n}\n\nexport function getInlineCode(match) {\n  const start = match.indexOf(\">\") + 1;\n  const end = match.lastIndexOf(\"<\");\n  return match.substring(start, end);\n}\n\nexport function defaultGetPublicPath(entry) {\n  if (typeof entry === \"object\") {\n    return \"/\";\n  }\n  try {\n    const { origin, pathname } = new URL(entry, location.href);\n    const paths = pathname.split(\"/\");\n    // 移除最后一个元素\n    paths.pop();\n    return `${origin}${paths.join(\"/\")}/`;\n  } catch (e) {\n    console.warn(e);\n    return \"\";\n  }\n}\n\n/** [f1, f2, f3, f4] => f4(f3(f2(f1))) 函数柯里化 */\nexport function compose(fnList: Array<Function>): (...args: Array<string>) => string {\n  return function (code: string, ...args: Array<any>) {\n    return fnList.reduce((newCode, fn) => (isFunction(fn) ? fn(newCode, ...args) : newCode), code || \"\");\n  };\n}\n\n// 微任务\nexport function nextTick(cb: () => any): void {\n  Promise.resolve().then(cb);\n}\n\n//执行钩子函数\nexport function execHooks(plugins: Array<plugin>, hookName: string, ...args: Array<any>): void {\n  try {\n    if (plugins && plugins.length > 0) {\n      plugins\n        .map((plugin) => plugin[hookName])\n        .filter((hook) => isFunction(hook))\n        .forEach((hook) => hook(...args));\n    }\n  } catch (e) {\n    error(e);\n  }\n}\n\nexport function isScriptElement(element: HTMLElement): boolean {\n  return element.tagName?.toUpperCase() === \"SCRIPT\";\n}\n\nlet count = 1;\nexport function setTagToScript(element: HTMLScriptElement, tag?: string): void {\n  if (isScriptElement(element)) {\n    const scriptTag = tag || String(count++);\n    element.setAttribute(WUJIE_SCRIPT_ID, scriptTag);\n  }\n}\n\nexport function getTagFromScript(element: HTMLScriptElement): string | null {\n  if (isScriptElement(element)) {\n    return element.getAttribute(WUJIE_SCRIPT_ID);\n  }\n  return null;\n}\n\n// 合并缓存\nexport function mergeOptions(options: cacheOptions, cacheOptions: cacheOptions) {\n  return {\n    name: options.name,\n    el: options.el || cacheOptions?.el,\n    url: options.url || cacheOptions?.url,\n    html: options.html || cacheOptions?.html,\n    exec: options.exec !== undefined ? options.exec : cacheOptions?.exec,\n    replace: options.replace || cacheOptions?.replace,\n    fetch: options.fetch || cacheOptions?.fetch,\n    props: options.props || cacheOptions?.props,\n    sync: options.sync !== undefined ? options.sync : cacheOptions?.sync,\n    prefix: options.prefix || cacheOptions?.prefix,\n    loading: options.loading || cacheOptions?.loading,\n    // 默认 {}\n    attrs: options.attrs !== undefined ? options.attrs : cacheOptions?.attrs || {},\n    degradeAttrs: options.degradeAttrs !== undefined ? options.degradeAttrs : cacheOptions?.degradeAttrs || {},\n    // 默认 true\n    fiber: options.fiber !== undefined ? options.fiber : cacheOptions?.fiber !== undefined ? cacheOptions?.fiber : true,\n    alive: options.alive !== undefined ? options.alive : cacheOptions?.alive,\n    degrade: options.degrade !== undefined ? options.degrade : cacheOptions?.degrade,\n    plugins: options.plugins || cacheOptions?.plugins,\n    lifecycles: {\n      beforeLoad: options.beforeLoad || cacheOptions?.beforeLoad,\n      beforeMount: options.beforeMount || cacheOptions?.beforeMount,\n      afterMount: options.afterMount || cacheOptions?.afterMount,\n      beforeUnmount: options.beforeUnmount || cacheOptions?.beforeUnmount,\n      afterUnmount: options.afterUnmount || cacheOptions?.afterUnmount,\n      activated: options.activated || cacheOptions?.activated,\n      deactivated: options.deactivated || cacheOptions?.deactivated,\n      loadError: options.loadError || cacheOptions?.loadError,\n    },\n  };\n}\n\n/**\n * 事件触发器\n */\nexport function eventTrigger(el: HTMLElement | Window | Document, eventName: string, detail?: any) {\n  let event;\n  if (typeof window.CustomEvent === \"function\") {\n    event = new CustomEvent(eventName, { detail });\n  } else {\n    event = document.createEvent(\"CustomEvent\");\n    event.initCustomEvent(eventName, true, false, detail);\n  }\n  el.dispatchEvent(event);\n}\n\nexport function stopMainAppRun() {\n  warn(WUJIE_TIPS_STOP_APP_DETAIL);\n  throw new Error(WUJIE_TIPS_STOP_APP);\n}\n"],"mappings":";;AAAA,SACEA,eADF,EAEEC,iBAFF,EAGEC,YAHF,EAIEC,mBAJF,EAKEC,0BALF,QAMO,YANP;AASA,OAAO,SAASC,OAAT,CAAoBC,KAApB,EAAyC;EAC9C,OAAOC,KAAK,CAACC,OAAN,CAAcF,KAAd,IAAuBA,KAAvB,GAA+B,CAACA,KAAD,CAAtC;AACD;AAED,OAAO,SAASG,UAAT,CAAoBC,KAApB,EAAyC;EAC9C,OAAO,OAAOA,KAAP,KAAiB,UAAxB;AACD;AAED,OAAO,SAASC,cAAT,CAAwBC,OAAxB,EAA0C;EAC/C,OACE,CAAAA,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEC,WAAT,QAA2B,MAA3B,IACA,CAAAD,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEC,WAAT,QAA2B,OAD3B,IAEA,CAAAD,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEC,WAAT,QAA2B,QAF3B,IAGA,CAAAD,OAAO,SAAP,IAAAA,OAAO,WAAP,YAAAA,OAAO,CAAEC,WAAT,QAA2B,QAJ7B;AAMD;AAED,OAAO,IAAMC,YAAY,GAAGC,MAAM,CAACC,KAAP,IAAgBD,MAAM,CAACE,qBAA5C;AAEP;AACA;AACA;AACA;AACA;AACA;;AACA,IAAMC,aAAa,GAAG,OAAOC,QAAQ,CAACC,GAAhB,KAAwB,UAAxB,IAAsC,OAAOD,QAAQ,CAACC,GAAhB,KAAwB,WAApF;AACA,IAAMC,kBAAkB,GAAG,IAAIC,OAAJ,EAA3B;AACA,OAAO,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACC,EAAD,EAAa;EACrC,IAAIH,kBAAkB,CAACI,GAAnB,CAAuBD,EAAvB,CAAJ,EAAgC;IAC9B,OAAO,IAAP;EACD;;EAED,IAAME,QAAQ,GAAGR,aAAa,GAAG,OAAOM,EAAP,KAAc,UAAd,IAA4B,OAAOA,EAAP,KAAc,WAA7C,GAA2D,OAAOA,EAAP,KAAc,UAAvG;;EACA,IAAIE,QAAJ,EAAc;IACZL,kBAAkB,CAACM,GAAnB,CAAuBH,EAAvB,EAA2BE,QAA3B;EACD;;EACD,OAAOA,QAAP;AACD,CAVM;AAYP,IAAME,UAAU,GAAG,IAAIN,OAAJ,EAAnB;AACA,OAAO,SAASO,iBAAT,CAA2BL,EAA3B,EAAiD;EACtD,IAAII,UAAU,CAACH,GAAX,CAAeD,EAAf,CAAJ,EAAwB;IACtB,OAAOI,UAAU,CAACE,GAAX,CAAeN,EAAf,CAAP;EACD;;EACD,IAAMO,OAAO,GAAGP,EAAE,CAACQ,IAAH,CAAQC,OAAR,CAAgB,QAAhB,MAA8B,CAA9B,IAAmC,CAACT,EAAE,CAACU,cAAH,CAAkB,WAAlB,CAApD;EACAN,UAAU,CAACD,GAAX,CAAeH,EAAf,EAAmBO,OAAnB;EACA,OAAOA,OAAP;AACD;AAED,IAAMI,oBAAoB,GAAG,IAAIb,OAAJ,EAA7B;AACA,OAAO,SAASc,eAAT,CAAyBZ,EAAzB,EAA8D;EACnE,IAAMa,mBAAmB,GACvBb,EAAE,CAACc,SAAH,IAAgBd,EAAE,CAACc,SAAH,CAAaC,WAAb,KAA6Bf,EAA7C,IAAmDgB,MAAM,CAACC,mBAAP,CAA2BjB,EAAE,CAACc,SAA9B,EAAyCI,MAAzC,GAAkD,CADvG;EAGA,IAAIL,mBAAJ,EAAyB,OAAO,IAAP;;EAEzB,IAAIF,oBAAoB,CAACV,GAArB,CAAyBD,EAAzB,CAAJ,EAAkC;IAChC,OAAOW,oBAAoB,CAACL,GAArB,CAAyBN,EAAzB,CAAP;EACD;;EAED,IAAImB,aAAa,GAAGN,mBAApB;;EACA,IAAI,CAACM,aAAL,EAAoB;IAClB,IAAMC,QAAQ,GAAGpB,EAAE,CAACqB,QAAH,EAAjB;IACA,IAAMC,0BAA0B,GAAG,sBAAnC;IACA,IAAMC,UAAU,GAAG,UAAnB;IACAJ,aAAa,GAAGG,0BAA0B,CAACE,IAA3B,CAAgCJ,QAAhC,KAA6CG,UAAU,CAACC,IAAX,CAAgBJ,QAAhB,CAA7D;EACD;;EAEDT,oBAAoB,CAACR,GAArB,CAAyBH,EAAzB,EAA6BmB,aAA7B;EACA,OAAOA,aAAP;AACD;AAED,IAAMM,aAAa,GAAG,IAAI3B,OAAJ,EAAtB;AACA,OAAO,SAAS4B,kBAAT,CAA4BxC,KAA5B,EAAwC;EAC7C,IAAIa,UAAU,CAACb,KAAD,CAAV,IAAqB,CAACmB,iBAAiB,CAACnB,KAAD,CAAvC,IAAkD,CAAC0B,eAAe,CAAC1B,KAAD,CAAtE,EAA+E;IAC7E,IAAI,CAACuC,aAAa,CAACxB,GAAd,CAAkBf,KAAlB,CAAL,EAA+B;MAC7BuC,aAAa,CAACtB,GAAd,CAAkBjB,KAAlB,EAAyBA,KAAzB;IACD;EACF;AACF;AAED,OAAO,SAASyC,cAAT,CAAwBC,MAAxB,EAAqCC,CAArC,EAAkD;EACvD,IAAM3C,KAAK,GAAG0C,MAAM,CAACC,CAAD,CAApB;;EACA,IAAIJ,aAAa,CAACxB,GAAd,CAAkBf,KAAlB,CAAJ,EAA8B;IAC5B,OAAOuC,aAAa,CAACnB,GAAd,CAAkBpB,KAAlB,CAAP;EACD;;EACD,IAAIa,UAAU,CAACb,KAAD,CAAV,IAAqB,CAACmB,iBAAiB,CAACnB,KAAD,CAAvC,IAAkD,CAAC0B,eAAe,CAAC1B,KAAD,CAAtE,EAA+E;IAC7E,IAAM4C,UAAU,GAAGC,QAAQ,CAACjB,SAAT,CAAmBkB,IAAnB,CAAwBC,IAAxB,CAA6B/C,KAA7B,EAAoC0C,MAApC,CAAnB;IACAH,aAAa,CAACtB,GAAd,CAAkBjB,KAAlB,EAAyB4C,UAAzB;;IAEA,KAAK,IAAMI,IAAX,IAAkBhD,KAAlB,EAAyB;MACvB4C,UAAU,CAACI,IAAD,CAAV,GAAkBhD,KAAK,CAACgD,IAAD,CAAvB;IACD;;IACD,IAAIhD,KAAK,CAACwB,cAAN,CAAqB,WAArB,KAAqC,CAACoB,UAAU,CAACpB,cAAX,CAA0B,WAA1B,CAA1C,EAAkF;MAChF;MACAM,MAAM,CAACmB,cAAP,CAAsBL,UAAtB,EAAkC,WAAlC,EAA+C;QAAE5C,KAAK,EAAEA,KAAK,CAAC4B,SAAf;QAA0BsB,UAAU,EAAE,KAAtC;QAA6CC,QAAQ,EAAE;MAAvD,CAA/C;IACD;;IACD,OAAOP,UAAP;EACD;;EACD,OAAO5C,KAAP;AACD;AAED,OAAO,SAASoD,gBAAT,CAA0BC,EAA1B,EAAyD;EAC9D,OAAOhD,MAAM,CAACI,QAAP,CAAgB6C,aAAhB,kBAAwC9D,YAAxC,gBAAyD6D,EAAzD,SAAP;AACD;AAED,OAAO,SAASE,iBAAT,CAA2BC,OAA3B,EAAiDC,KAAjD,EAAgF;EACrF3B,MAAM,CAAC4B,IAAP,CAAYD,KAAZ,EAAmBE,OAAnB,CAA2B,UAACrC,IAAD,EAAU;IACnCkC,OAAO,CAACI,YAAR,CAAqBtC,IAArB,EAA2BmC,KAAK,CAACnC,IAAD,CAAhC;EACD,CAFD;AAGD;AAED,OAAO,SAASuC,aAAT,CAAuBC,GAAvB,EAIL;EACA,IAAI,CAACA,GAAL,EAAU;IACRC,KAAK,CAACxE,iBAAD,CAAL;IACA,MAAM,IAAIyE,KAAJ,EAAN;EACD;;EACD,IAAMC,UAAU,GAAGC,sBAAsB,CAACJ,GAAD,CAAzC;EACA,IAAMK,WAAW,GAAGF,UAAU,CAACG,QAAX,GAAsB,IAAtB,GAA6BH,UAAU,CAACI,IAA5D;EACA,IAAIC,YAAY,GAAGL,UAAU,CAACM,QAAX,GAAsBN,UAAU,CAACO,MAAjC,GAA0CP,UAAU,CAACQ,IAAxE;EACA,IAAI,CAACH,YAAY,CAACI,UAAb,CAAwB,GAAxB,CAAL,EAAmCJ,YAAY,GAAG,MAAMA,YAArB,CARnC,CAQsE;;EACtE,OAAO;IAAEL,UAAU,EAAVA,UAAF;IAAcE,WAAW,EAAXA,WAAd;IAA2BG,YAAY,EAAZA;EAA3B,CAAP;AACD;AAED,OAAO,SAASJ,sBAAT,CAAgCJ,GAAhC,EAAgE;EACrE,IAAMN,OAAO,GAAGnD,MAAM,CAACI,QAAP,CAAgBkE,aAAhB,CAA8B,GAA9B,CAAhB;EACAnB,OAAO,CAACoB,IAAR,GAAed,GAAf;EACAN,OAAO,CAACoB,IAAR,GAAepB,OAAO,CAACoB,IAAvB,CAHqE,CAGxC;;EAC7B,OAAOpB,OAAP;AACD;AAED,OAAO,SAASqB,wBAAT,CAAkCC,aAAlC,EAA+F;EACpG,IAAMC,SAAS,GAAGD,aAAa,CAACN,MAAd,CAAqBQ,OAArB,CAA6B,GAA7B,EAAkC,EAAlC,EAAsCC,KAAtC,CAA4C,GAA5C,CAAlB;EACA,IAAMC,QAAQ,GAAG,EAAjB;EACAH,SAAS,CAACpB,OAAV,CAAkB,UAACwB,KAAD,EAAW;IAC3B,mBAAqBA,KAAK,CAACF,KAAN,CAAY,GAAZ,CAArB;IAAA;IAAA,IAAOjC,GAAP;IAAA,IAAYhD,KAAZ;;IACA,IAAIgD,GAAG,IAAIhD,KAAX,EAAkBkF,QAAQ,CAAClC,GAAD,CAAR,GAAgBhD,KAAhB;EACnB,CAHD;EAIA,OAAOkF,QAAP;AACD;AAED;AACA;AACA;;AACA,OAAO,SAASE,oBAAT,CAA8B/B,EAA9B,EAAmD;EACxD,IAAM6B,QAAQ,GAAGL,wBAAwB,CAACX,sBAAsB,CAAC7D,MAAM,CAACgF,QAAP,CAAgBT,IAAjB,CAAvB,CAAzC;EACA,OAAO9C,MAAM,CAAC4B,IAAP,CAAYwB,QAAZ,EAAsBI,QAAtB,CAA+BjC,EAA/B,CAAP;AACD;AAED;AACA;AACA;AACA;;AACA,OAAO,SAASkC,sBAAT,CACLC,YADK,EAELC,UAFK,EASLC,IATK,EAUC;EACN;EACA,IAAMC,sBAAsB,GAAGH,YAAY,CAACI,OAAb,CAAqBhE,SAArB,CAA+BgC,YAA9D;;EACA6B,UAAU,CAAC7D,SAAX,CAAqBgC,YAArB,GAAoC,UAAUtC,IAAV,EAAwBtB,KAAxB,EAA6C;IAC/E,IAAI6F,WAAW,GAAG7F,KAAlB;IACA,IAAIsB,IAAI,KAAKoE,IAAb,EAAmBG,WAAW,GAAGC,eAAe,CAAC9F,KAAD,EAAQ,KAAK+F,OAAL,IAAgB,EAAxB,EAA4B,IAA5B,CAA7B;IACnBJ,sBAAsB,CAAC5C,IAAvB,CAA4B,IAA5B,EAAkCzB,IAAlC,EAAwCuE,WAAxC;EACD,CAJD,CAHM,CAQN;;;EACA,IAAMG,8BAA8B,GAAGlE,MAAM,CAACmE,wBAAP,CAAgCR,UAAU,CAAC7D,SAA3C,EAAsD8D,IAAtD,CAAvC;EACA,IAAQxC,UAAR,GAA+C8C,8BAA/C,CAAQ9C,UAAR;EAAA,IAAoBgD,YAApB,GAA+CF,8BAA/C,CAAoBE,YAApB;EAAA,IAAkC9E,IAAlC,GAA+C4E,8BAA/C,CAAkC5E,GAAlC;EAAA,IAAuCH,IAAvC,GAA+C+E,8BAA/C,CAAuC/E,GAAvC;EACAa,MAAM,CAACmB,cAAP,CAAsBwC,UAAU,CAAC7D,SAAjC,EAA4C8D,IAA5C,EAAkD;IAChDxC,UAAU,EAAVA,UADgD;IAEhDgD,YAAY,EAAZA,YAFgD;IAGhD9E,GAAG,EAAE,eAAY;MACf,OAAOA,IAAG,CAAC2B,IAAJ,CAAS,IAAT,CAAP;IACD,CAL+C;IAMhD9B,GAAG,EAAE,aAAU2D,IAAV,EAAgB;MACnB3D,IAAG,CAAC8B,IAAJ,CAAS,IAAT,EAAe+C,eAAe,CAAClB,IAAD,EAAO,KAAKmB,OAAZ,EAAqB,IAArB,CAA9B;IACD;EAR+C,CAAlD,EAXM,CAqBN;AACD;AAED,OAAO,SAASI,SAAT,CAAmBC,aAAnB,EAAkD;EACvD,IAAMf,QAAQ,GAAGe,aAAjB;EACA,OAAOf,QAAQ,CAACjB,QAAT,GAAoB,IAApB,GAA2BiB,QAAQ,CAAChB,IAApC,GAA2CgB,QAAQ,CAACd,QAA3D;AACD;AAED,OAAO,SAASuB,eAAT,CAAyBhC,GAAzB,EAAsCuC,IAAtC,EAAoD5B,IAApD,EAA4E;EACjF,IAAI;IACF;IACA,IAAIX,GAAJ,EAAS;MACP;MACA,IAAIW,IAAI,IAAIX,GAAG,CAACY,UAAJ,CAAe,GAAf,CAAZ,EAAiC,OAAOZ,GAAP;MACjC,OAAO,IAAIwC,GAAJ,CAAQxC,GAAR,EAAauC,IAAb,EAAmBzB,IAA1B;IACD,CAJD,MAIO,OAAOd,GAAP;EACR,CAPD,CAOE,gBAAM;IACN,OAAOA,GAAP;EACD;AACF;AACD;AACA;AACA;;AACA,OAAO,SAASyC,UAAT,CAAoBlD,EAApB,EAAgCmD,MAAhC,EAA2E;EAAA;;EAChF,IAAIC,aAAa,GAAGvC,sBAAsB,CAAC7D,MAAM,CAACgF,QAAP,CAAgBT,IAAjB,CAA1C;EACA,IAAMM,QAAQ,GAAGL,wBAAwB,CAAC4B,aAAD,CAAzC;EACAA,aAAa,GAAG,IAAhB;EACA,IAAMC,OAAO,GAAGrG,MAAM,CAACsG,kBAAP,CAA0BzB,QAAQ,CAAC7B,EAAD,CAAR,IAAgB,EAA1C,CAAhB;EACA,IAAMuD,cAAc,qBAAGF,OAAO,CAACG,KAAR,CAAc,YAAd,CAAH,mDAAG,eAA8B,CAA9B,CAAvB;;EACA,IAAIL,MAAM,IAAII,cAAd,EAA8B;IAC5B,OAAOF,OAAO,CAAC1B,OAAR,YAAoB4B,cAApB,QAAuCJ,MAAM,CAACI,cAAD,CAA7C,CAAP;EACD;;EACD,OAAOF,OAAP;AACD,C,CACD;;AACA,OAAO,IAAMI,mBAAmB,GAAGzG,MAAM,CAACyG,mBAAP,IAA+B,UAACC,EAAD;EAAA,OAAkBC,UAAU,CAACD,EAAD,EAAK,CAAL,CAA5B;AAAA,CAA3D;AAEP,OAAO,SAASE,YAAT,CAAsBC,SAAtB,EAAoE;EACzE,OAAO,OAAOA,SAAP,KAAqB,QAArB,GAAiCzG,QAAQ,CAAC6C,aAAT,CAAuB4D,SAAvB,CAAjC,GAAqFA,SAA5F;AACD;AAED,OAAO,SAASC,IAAT,CAAcC,GAAd,EAA2BC,IAA3B,EAA6C;EAAA;;EAClD,YAAAC,OAAO,UAAP,4CAASH,IAAT,yBAA+BC,GAA/B,GAAsCC,IAAtC;AACD;AAED,OAAO,SAAStD,KAAT,CAAeqD,GAAf,EAA4BC,IAA5B,EAA8C;EAAA;;EACnD,aAAAC,OAAO,UAAP,8CAASvD,KAAT,0BAAiCqD,GAAjC,GAAwCC,IAAxC;AACD;AAED,OAAO,SAASE,aAAT,CAAuBV,KAAvB,EAA8B;EACnC,IAAMW,KAAK,GAAGX,KAAK,CAACtF,OAAN,CAAc,GAAd,IAAqB,CAAnC;EACA,IAAMkG,GAAG,GAAGZ,KAAK,CAACa,WAAN,CAAkB,GAAlB,CAAZ;EACA,OAAOb,KAAK,CAACc,SAAN,CAAgBH,KAAhB,EAAuBC,GAAvB,CAAP;AACD;AAED,OAAO,SAASG,oBAAT,CAA8BC,KAA9B,EAAqC;EAC1C,IAAI,QAAOA,KAAP,MAAiB,QAArB,EAA+B;IAC7B,OAAO,GAAP;EACD;;EACD,IAAI;IACF,WAA6B,IAAIvB,GAAJ,CAAQuB,KAAR,EAAexC,QAAQ,CAACT,IAAxB,CAA7B;IAAA,IAAQkD,MAAR,QAAQA,MAAR;IAAA,IAAgBvD,QAAhB,QAAgBA,QAAhB;;IACA,IAAMwD,KAAK,GAAGxD,QAAQ,CAACU,KAAT,CAAe,GAAf,CAAd,CAFE,CAGF;;IACA8C,KAAK,CAACC,GAAN;IACA,iBAAUF,MAAV,SAAmBC,KAAK,CAACE,IAAN,CAAW,GAAX,CAAnB;EACD,CAND,CAME,OAAOC,CAAP,EAAU;IACVZ,OAAO,CAACH,IAAR,CAAae,CAAb;IACA,OAAO,EAAP;EACD;AACF;AAED;;AACA,OAAO,SAASC,OAAT,CAAiBC,MAAjB,EAA8E;EACnF,OAAO,UAAUC,IAAV,EAA6C;IAAA,kCAAlBC,IAAkB;MAAlBA,IAAkB;IAAA;;IAClD,OAAOF,MAAM,CAACG,MAAP,CAAc,UAACC,OAAD,EAAU1H,EAAV;MAAA,OAAkBf,UAAU,CAACe,EAAD,CAAV,GAAiBA,EAAE,MAAF,UAAG0H,OAAH,SAAeF,IAAf,EAAjB,GAAwCE,OAA1D;IAAA,CAAd,EAAkFH,IAAI,IAAI,EAA1F,CAAP;EACD,CAFD;AAGD,C,CAED;;AACA,OAAO,SAASI,QAAT,CAAkB1B,EAAlB,EAAuC;EAC5C2B,OAAO,CAACC,OAAR,GAAkBC,IAAlB,CAAuB7B,EAAvB;AACD,C,CAED;;AACA,OAAO,SAAS8B,SAAT,CAAmBC,OAAnB,EAA2CC,QAA3C,EAAwF;EAAA,mCAAxBT,IAAwB;IAAxBA,IAAwB;EAAA;;EAC7F,IAAI;IACF,IAAIQ,OAAO,IAAIA,OAAO,CAAC9G,MAAR,GAAiB,CAAhC,EAAmC;MACjC8G,OAAO,CACJE,GADH,CACO,UAACC,MAAD;QAAA,OAAYA,MAAM,CAACF,QAAD,CAAlB;MAAA,CADP,EAEGG,MAFH,CAEU,UAACC,IAAD;QAAA,OAAUpJ,UAAU,CAACoJ,IAAD,CAApB;MAAA,CAFV,EAGGxF,OAHH,CAGW,UAACwF,IAAD;QAAA,OAAUA,IAAI,MAAJ,SAAQb,IAAR,CAAV;MAAA,CAHX;IAID;EACF,CAPD,CAOE,OAAOJ,CAAP,EAAU;IACVnE,KAAK,CAACmE,CAAD,CAAL;EACD;AACF;AAED,OAAO,SAASkB,eAAT,CAAyB5F,OAAzB,EAAwD;EAAA;;EAC7D,OAAO,qBAAAA,OAAO,CAACtD,OAAR,sEAAiBC,WAAjB,QAAmC,QAA1C;AACD;AAED,IAAIkJ,KAAK,GAAG,CAAZ;AACA,OAAO,SAASC,cAAT,CAAwB9F,OAAxB,EAAoD+F,GAApD,EAAwE;EAC7E,IAAIH,eAAe,CAAC5F,OAAD,CAAnB,EAA8B;IAC5B,IAAMgG,SAAS,GAAGD,GAAG,IAAIE,MAAM,CAACJ,KAAK,EAAN,CAA/B;IACA7F,OAAO,CAACI,YAAR,CAAqBtE,eAArB,EAAsCkK,SAAtC;EACD;AACF;AAED,OAAO,SAASE,gBAAT,CAA0BlG,OAA1B,EAAqE;EAC1E,IAAI4F,eAAe,CAAC5F,OAAD,CAAnB,EAA8B;IAC5B,OAAOA,OAAO,CAACmG,YAAR,CAAqBrK,eAArB,CAAP;EACD;;EACD,OAAO,IAAP;AACD,C,CAED;;AACA,OAAO,SAASsK,YAAT,CAAsBC,OAAtB,EAA6CC,YAA7C,EAAyE;EAC9E,OAAO;IACLxI,IAAI,EAAEuI,OAAO,CAACvI,IADT;IAELyI,EAAE,EAAEF,OAAO,CAACE,EAAR,KAAcD,YAAd,aAAcA,YAAd,uBAAcA,YAAY,CAAEC,EAA5B,CAFC;IAGLjG,GAAG,EAAE+F,OAAO,CAAC/F,GAAR,KAAegG,YAAf,aAAeA,YAAf,uBAAeA,YAAY,CAAEhG,GAA7B,CAHA;IAILkG,IAAI,EAAEH,OAAO,CAACG,IAAR,KAAgBF,YAAhB,aAAgBA,YAAhB,uBAAgBA,YAAY,CAAEE,IAA9B,CAJD;IAKLC,IAAI,EAAEJ,OAAO,CAACI,IAAR,KAAiBC,SAAjB,GAA6BL,OAAO,CAACI,IAArC,GAA4CH,YAA5C,aAA4CA,YAA5C,uBAA4CA,YAAY,CAAEG,IAL3D;IAMLjF,OAAO,EAAE6E,OAAO,CAAC7E,OAAR,KAAmB8E,YAAnB,aAAmBA,YAAnB,uBAAmBA,YAAY,CAAE9E,OAAjC,CANJ;IAOLmF,KAAK,EAAEN,OAAO,CAACM,KAAR,KAAiBL,YAAjB,aAAiBA,YAAjB,uBAAiBA,YAAY,CAAEK,KAA/B,CAPF;IAQLC,KAAK,EAAEP,OAAO,CAACO,KAAR,KAAiBN,YAAjB,aAAiBA,YAAjB,uBAAiBA,YAAY,CAAEM,KAA/B,CARF;IASLC,IAAI,EAAER,OAAO,CAACQ,IAAR,KAAiBH,SAAjB,GAA6BL,OAAO,CAACQ,IAArC,GAA4CP,YAA5C,aAA4CA,YAA5C,uBAA4CA,YAAY,CAAEO,IAT3D;IAUL7D,MAAM,EAAEqD,OAAO,CAACrD,MAAR,KAAkBsD,YAAlB,aAAkBA,YAAlB,uBAAkBA,YAAY,CAAEtD,MAAhC,CAVH;IAWL8D,OAAO,EAAET,OAAO,CAACS,OAAR,KAAmBR,YAAnB,aAAmBA,YAAnB,uBAAmBA,YAAY,CAAEQ,OAAjC,CAXJ;IAYL;IACA7G,KAAK,EAAEoG,OAAO,CAACpG,KAAR,KAAkByG,SAAlB,GAA8BL,OAAO,CAACpG,KAAtC,GAA8C,CAAAqG,YAAY,SAAZ,IAAAA,YAAY,WAAZ,YAAAA,YAAY,CAAErG,KAAd,KAAuB,EAbvE;IAcL8G,YAAY,EAAEV,OAAO,CAACU,YAAR,KAAyBL,SAAzB,GAAqCL,OAAO,CAACU,YAA7C,GAA4D,CAAAT,YAAY,SAAZ,IAAAA,YAAY,WAAZ,YAAAA,YAAY,CAAES,YAAd,KAA8B,EAdnG;IAeL;IACAC,KAAK,EAAEX,OAAO,CAACW,KAAR,KAAkBN,SAAlB,GAA8BL,OAAO,CAACW,KAAtC,GAA8C,CAAAV,YAAY,SAAZ,IAAAA,YAAY,WAAZ,YAAAA,YAAY,CAAEU,KAAd,MAAwBN,SAAxB,GAAoCJ,YAApC,aAAoCA,YAApC,uBAAoCA,YAAY,CAAEU,KAAlD,GAA0D,IAhB1G;IAiBLC,KAAK,EAAEZ,OAAO,CAACY,KAAR,KAAkBP,SAAlB,GAA8BL,OAAO,CAACY,KAAtC,GAA8CX,YAA9C,aAA8CA,YAA9C,uBAA8CA,YAAY,CAAEW,KAjB9D;IAkBLC,OAAO,EAAEb,OAAO,CAACa,OAAR,KAAoBR,SAApB,GAAgCL,OAAO,CAACa,OAAxC,GAAkDZ,YAAlD,aAAkDA,YAAlD,uBAAkDA,YAAY,CAAEY,OAlBpE;IAmBL5B,OAAO,EAAEe,OAAO,CAACf,OAAR,KAAmBgB,YAAnB,aAAmBA,YAAnB,uBAAmBA,YAAY,CAAEhB,OAAjC,CAnBJ;IAoBL6B,UAAU,EAAE;MACVC,UAAU,EAAEf,OAAO,CAACe,UAAR,KAAsBd,YAAtB,aAAsBA,YAAtB,uBAAsBA,YAAY,CAAEc,UAApC,CADF;MAEVC,WAAW,EAAEhB,OAAO,CAACgB,WAAR,KAAuBf,YAAvB,aAAuBA,YAAvB,uBAAuBA,YAAY,CAAEe,WAArC,CAFH;MAGVC,UAAU,EAAEjB,OAAO,CAACiB,UAAR,KAAsBhB,YAAtB,aAAsBA,YAAtB,uBAAsBA,YAAY,CAAEgB,UAApC,CAHF;MAIVC,aAAa,EAAElB,OAAO,CAACkB,aAAR,KAAyBjB,YAAzB,aAAyBA,YAAzB,uBAAyBA,YAAY,CAAEiB,aAAvC,CAJL;MAKVC,YAAY,EAAEnB,OAAO,CAACmB,YAAR,KAAwBlB,YAAxB,aAAwBA,YAAxB,uBAAwBA,YAAY,CAAEkB,YAAtC,CALJ;MAMVC,SAAS,EAAEpB,OAAO,CAACoB,SAAR,KAAqBnB,YAArB,aAAqBA,YAArB,uBAAqBA,YAAY,CAAEmB,SAAnC,CAND;MAOVC,WAAW,EAAErB,OAAO,CAACqB,WAAR,KAAuBpB,YAAvB,aAAuBA,YAAvB,uBAAuBA,YAAY,CAAEoB,WAArC,CAPH;MAQVC,SAAS,EAAEtB,OAAO,CAACsB,SAAR,KAAqBrB,YAArB,aAAqBA,YAArB,uBAAqBA,YAAY,CAAEqB,SAAnC;IARD;EApBP,CAAP;AA+BD;AAED;AACA;AACA;;AACA,OAAO,SAASC,YAAT,CAAsBrB,EAAtB,EAA2DsB,SAA3D,EAA8EC,MAA9E,EAA4F;EACjG,IAAIC,KAAJ;;EACA,IAAI,OAAOlL,MAAM,CAACmL,WAAd,KAA8B,UAAlC,EAA8C;IAC5CD,KAAK,GAAG,IAAIC,WAAJ,CAAgBH,SAAhB,EAA2B;MAAEC,MAAM,EAANA;IAAF,CAA3B,CAAR;EACD,CAFD,MAEO;IACLC,KAAK,GAAG9K,QAAQ,CAACgL,WAAT,CAAqB,aAArB,CAAR;IACAF,KAAK,CAACG,eAAN,CAAsBL,SAAtB,EAAiC,IAAjC,EAAuC,KAAvC,EAA8CC,MAA9C;EACD;;EACDvB,EAAE,CAAC4B,aAAH,CAAiBJ,KAAjB;AACD;AAED,OAAO,SAASK,cAAT,GAA0B;EAC/BzE,IAAI,CAACzH,0BAAD,CAAJ;EACA,MAAM,IAAIsE,KAAJ,CAAUvE,mBAAV,CAAN;AACD"}