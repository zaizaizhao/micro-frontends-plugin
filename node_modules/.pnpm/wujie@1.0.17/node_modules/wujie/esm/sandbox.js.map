{"version":3,"file":"sandbox.js","names":["iframeGenerator","recoverEventListeners","recoverDocumentListeners","insertScriptToIframe","patchEventTimeStamp","syncUrlToWindow","syncUrlToIframe","clearInactiveAppUrl","createWujieWebComponent","clearChild","getPatchStyleElements","renderElementToContainer","renderTemplateToShadowRoot","renderTemplateToIframe","initRenderIframeAndContainer","removeLoading","proxyGenerator","localGenerator","getPlugins","getPresetLoaders","removeEventListener","idToSandboxCacheMap","addSandboxCacheWithWujie","deleteWujieById","rawElementAppendChild","rawDocumentQuerySelector","EventBus","appEventObjMap","isFunction","wujieSupport","appRouteParse","requestIdleCallback","getAbsolutePath","eventTrigger","WUJIE_DATA_ATTACH_CSS_FLAG","Wujie","options","WeakMap","window","__POWERED_BY_WUJIE__","inject","__WUJIE","idToSandboxMap","mainHostPath","location","protocol","host","name","url","attrs","fiber","degradeAttrs","degrade","lifecycles","plugins","id","bus","provide","styleSheetElements","execQueue","urlElement","appHostPath","appRoutePath","iframe","proxyDocument","proxyLocation","proxyWindow","proxy","sync","el","template","props","alive","prefix","fetch","replace","hrefFlag","activeFlag","iframeReady","iframeWindow","contentWindow","iframeFetch","input","init","href","execFlag","iframeBody","call","document","container","onunload","unmount","contentDocument","replaceChild","documentElement","shadowRoot","patchCssRules","getExternalScripts","scriptResultList","beforeScriptResultList","afterScriptResultList","syncScriptResultList","asyncScriptResultList","deferScriptResultList","forEach","scriptResult","defer","push","async","beforeScriptResult","concat","contentPromise","then","content","mount","domContentLoadedTrigger","shift","afterScriptResult","domLoadedTrigger","__WUJIE_UNMOUNT","Promise","resolve","mountFlag","__WUJIE_MOUNT","beforeMount","afterMount","activated","deactivated","beforeUnmount","afterUnmount","$clear","head","body","elementEventCacheMap","parentNode","removeChild","length","styleSheetElement","hasAttribute","Array","from","querySelectorAll","map","sheet","hostStyleSheetElement","fontStyleSheetElement","appendChild","setAttribute"],"sources":["../src/sandbox.ts"],"sourcesContent":["import {\n  iframeGenerator,\n  recoverEventListeners,\n  recoverDocumentListeners,\n  insertScriptToIframe,\n  patchEventTimeStamp,\n} from \"./iframe\";\nimport { syncUrlToWindow, syncUrlToIframe, clearInactiveAppUrl } from \"./sync\";\nimport {\n  createWujieWebComponent,\n  clearChild,\n  getPatchStyleElements,\n  renderElementToContainer,\n  renderTemplateToShadowRoot,\n  renderTemplateToIframe,\n  initRenderIframeAndContainer,\n  removeLoading,\n} from \"./shadow\";\nimport { proxyGenerator, localGenerator } from \"./proxy\";\nimport { ScriptResultList } from \"./entry\";\nimport { getPlugins, getPresetLoaders } from \"./plugin\";\nimport { removeEventListener } from \"./effect\";\nimport {\n  SandboxCache,\n  idToSandboxCacheMap,\n  addSandboxCacheWithWujie,\n  deleteWujieById,\n  rawElementAppendChild,\n  rawDocumentQuerySelector,\n} from \"./common\";\nimport { EventBus, appEventObjMap, EventObj } from \"./event\";\nimport { isFunction, wujieSupport, appRouteParse, requestIdleCallback, getAbsolutePath, eventTrigger } from \"./utils\";\nimport { WUJIE_DATA_ATTACH_CSS_FLAG } from \"./constant\";\nimport { plugin, ScriptObjectLoader, loadErrorHandler } from \"./index\";\n\nexport type lifecycle = (appWindow: Window) => any;\ntype lifecycles = {\n  beforeLoad: lifecycle;\n  beforeMount: lifecycle;\n  afterMount: lifecycle;\n  beforeUnmount: lifecycle;\n  afterUnmount: lifecycle;\n  activated: lifecycle;\n  deactivated: lifecycle;\n  loadError: loadErrorHandler;\n};\n/**\n * 基于 Proxy和iframe 实现的沙箱\n */\nexport default class Wujie {\n  public id: string;\n  /** 激活时路由地址 */\n  public url: string;\n  /** 子应用保活 */\n  public alive: boolean;\n  /** window代理 */\n  public proxy: WindowProxy;\n  /** document代理 */\n  public proxyDocument: Object;\n  /** location代理 */\n  public proxyLocation: Object;\n  /** 事件中心 */\n  public bus: EventBus;\n  /** 容器 */\n  public el: HTMLElement;\n  /** js沙箱 */\n  public iframe: HTMLIFrameElement;\n  /** css沙箱 */\n  public shadowRoot: ShadowRoot;\n  /** 子应用的template */\n  public template: string;\n  /** 子应用代码替换钩子 */\n  public replace: (code: string) => string;\n  /** 子应用自定义fetch */\n  public fetch: (input: RequestInfo, init?: RequestInit) => Promise<Response>;\n  /** 子应用的生命周期 */\n  public lifecycles: lifecycles;\n  /** 子应用的插件 */\n  public plugins: Array<plugin>;\n  /** js沙箱ready态 */\n  public iframeReady: Promise<void>;\n  /** 子应用预加载态 */\n  public preload: Promise<void>;\n  /** 降级时渲染iframe的属性 */\n  public degradeAttrs: { [key: string]: any };\n  /** 子应用js执行队列 */\n  public execQueue: Array<Function>;\n  /** 子应用执行过标志 */\n  public execFlag: boolean;\n  /** 子应用激活标志 */\n  public activeFlag: boolean;\n  /** 子应用mount标志 */\n  public mountFlag: boolean;\n  /** 路由同步标志 */\n  public sync: boolean;\n  /** 子应用短路径替换，路由同步时生效 */\n  public prefix: { [key: string]: string };\n  /** 子应用跳转标志 */\n  public hrefFlag: boolean;\n  /** 子应用采用fiber模式执行 */\n  public fiber: boolean;\n  /** 子应用降级标志 */\n  public degrade: boolean;\n  /** 子应用降级document */\n  public document: Document;\n  /** 子应用styleSheet元素 */\n  public styleSheetElements: Array<HTMLLinkElement | HTMLStyleElement>;\n  /** 子应用head元素 */\n  public head: HTMLHeadElement;\n  /** 子应用body元素 */\n  public body: HTMLBodyElement;\n  /** 子应用dom监听事件留存，当降级时用于保存元素事件 */\n  public elementEventCacheMap: WeakMap<\n    Node,\n    Array<{ type: string; handler: EventListenerOrEventListenerObject; options: any }>\n  > = new WeakMap();\n\n  /** $wujie对象，提供给子应用的接口 */\n  public provide: {\n    bus: EventBus;\n    shadowRoot?: ShadowRoot;\n    props?: { [key: string]: any };\n    location?: Object;\n  };\n\n  /** 子应用嵌套场景，父应用传递给子应用的数据 */\n  public inject: {\n    idToSandboxMap: Map<String, SandboxCache>;\n    appEventObjMap: Map<String, EventObj>;\n    mainHostPath: string;\n  };\n\n  /** 激活子应用\n   * 1、同步路由\n   * 2、动态修改iframe的fetch\n   * 3、准备shadow\n   * 4、准备子应用注入\n   */\n  public async active(options: {\n    url: string;\n    sync?: boolean;\n    prefix?: { [key: string]: string };\n    template?: string;\n    el?: string | HTMLElement;\n    props?: { [key: string]: any };\n    alive?: boolean;\n    fetch?: (input: RequestInfo, init?: RequestInit) => Promise<Response>;\n    replace?: (code: string) => string;\n  }): Promise<void> {\n    const { sync, url, el, template, props, alive, prefix, fetch, replace } = options;\n    this.url = url;\n    this.sync = sync;\n    this.alive = alive;\n    this.hrefFlag = false;\n    this.prefix = prefix ?? this.prefix;\n    this.replace = replace ?? this.replace;\n    this.provide.props = props ?? this.provide.props;\n    this.activeFlag = true;\n    // wait iframe init\n    await this.iframeReady;\n\n    // 处理子应用自定义fetch\n    // TODO fetch检验合法性\n    const iframeWindow = this.iframe.contentWindow;\n    const iframeFetch = fetch\n      ? (input: RequestInfo, init?: RequestInit) =>\n          fetch(typeof input === \"string\" ? getAbsolutePath(input, (this.proxyLocation as Location).href) : input, init)\n      : this.fetch;\n    if (iframeFetch) {\n      iframeWindow.fetch = iframeFetch;\n      this.fetch = iframeFetch;\n    }\n\n    // 处理子应用路由同步\n    if (this.execFlag && this.alive) {\n      // 当保活模式下子应用重新激活时，只需要将子应用路径同步回主应用\n      syncUrlToWindow(iframeWindow);\n    } else {\n      // 先将url同步回iframe，然后再同步回浏览器url\n      syncUrlToIframe(iframeWindow);\n      syncUrlToWindow(iframeWindow);\n    }\n\n    // inject template\n    this.template = template ?? this.template;\n\n    /* 降级处理 */\n    if (this.degrade) {\n      const iframeBody = rawDocumentQuerySelector.call(iframeWindow.document, \"body\") as HTMLElement;\n      const { iframe, container } = initRenderIframeAndContainer(this.id, el ?? iframeBody, this.degradeAttrs);\n      this.el = container;\n      // 销毁js运行iframe容器内部dom\n      if (el) clearChild(iframeBody);\n      // 修复vue的event.timeStamp问题\n      patchEventTimeStamp(iframe.contentWindow, iframeWindow);\n      // 当销毁iframe时主动unmount子应用\n      iframe.contentWindow.onunload = () => {\n        this.unmount();\n      };\n      if (this.document) {\n        if (this.alive) {\n          iframe.contentDocument.replaceChild(this.document.documentElement, iframe.contentDocument.documentElement);\n          // 保活场景需要事件全部恢复\n          recoverEventListeners(iframe.contentDocument.documentElement, iframeWindow);\n        } else {\n          await renderTemplateToIframe(iframe.contentDocument, this.iframe.contentWindow, this.template);\n          // 非保活场景需要恢复根节点的事件，防止react16监听事件丢失\n          recoverDocumentListeners(this.document.documentElement, iframe.contentDocument.documentElement, iframeWindow);\n        }\n      } else {\n        await renderTemplateToIframe(iframe.contentDocument, this.iframe.contentWindow, this.template);\n      }\n      this.document = iframe.contentDocument;\n      return;\n    }\n\n    if (this.shadowRoot) {\n      /*\n       document.addEventListener was transfer to shadowRoot.addEventListener\n       react 16 SyntheticEvent will remember document event for avoid repeat listen\n       shadowRoot have to dispatchEvent for react 16 so can't be destroyed\n       this may lead memory leak risk\n       */\n      this.el = renderElementToContainer(this.shadowRoot.host, el);\n      if (this.alive) return;\n    } else {\n      // 预执行无容器，暂时插入iframe内部触发Web Component的connect\n      const iframeBody = rawDocumentQuerySelector.call(iframeWindow.document, \"body\") as HTMLElement;\n      this.el = renderElementToContainer(createWujieWebComponent(this.id), el ?? iframeBody);\n    }\n\n    await renderTemplateToShadowRoot(this.shadowRoot, iframeWindow, this.template);\n    this.patchCssRules();\n\n    // inject shadowRoot to app\n    this.provide.shadowRoot = this.shadowRoot;\n  }\n\n  /** 启动子应用\n   * 1、运行js\n   * 2、处理兼容样式\n   */\n  public async start(getExternalScripts: () => ScriptResultList): Promise<void> {\n    this.execFlag = true;\n    // 执行脚本\n    const scriptResultList = await getExternalScripts();\n    // 假如已经被销毁了\n    if (!this.iframe) return;\n    const iframeWindow = this.iframe.contentWindow;\n    // 标志位，执行代码前设置\n    iframeWindow.__POWERED_BY_WUJIE__ = true;\n    // 用户自定义代码前\n    const beforeScriptResultList: ScriptObjectLoader[] = getPresetLoaders(\"jsBeforeLoaders\", this.plugins);\n    // 用户自定义代码后\n    const afterScriptResultList: ScriptObjectLoader[] = getPresetLoaders(\"jsAfterLoaders\", this.plugins);\n    // 同步代码\n    const syncScriptResultList: ScriptResultList = [];\n    // async代码无需保证顺序，所以不用放入执行队列\n    const asyncScriptResultList: ScriptResultList = [];\n    // defer代码需要保证顺序并且DOMContentLoaded前完成，这里统一放置同步脚本后执行\n    const deferScriptResultList: ScriptResultList = [];\n    scriptResultList.forEach((scriptResult) => {\n      if (scriptResult.defer) deferScriptResultList.push(scriptResult);\n      else if (scriptResult.async) asyncScriptResultList.push(scriptResult);\n      else syncScriptResultList.push(scriptResult);\n    });\n\n    // 插入代码前\n    beforeScriptResultList.forEach((beforeScriptResult) => {\n      this.execQueue.push(() =>\n        this.fiber\n          ? requestIdleCallback(() => insertScriptToIframe(beforeScriptResult, iframeWindow))\n          : insertScriptToIframe(beforeScriptResult, iframeWindow)\n      );\n    });\n\n    // 同步代码\n    syncScriptResultList.concat(deferScriptResultList).forEach((scriptResult) => {\n      this.execQueue.push(() =>\n        scriptResult.contentPromise.then((content) =>\n          this.fiber\n            ? requestIdleCallback(() => insertScriptToIframe({ ...scriptResult, content }, iframeWindow))\n            : insertScriptToIframe({ ...scriptResult, content }, iframeWindow)\n        )\n      );\n    });\n\n    // 异步代码\n    asyncScriptResultList.forEach((scriptResult) => {\n      scriptResult.contentPromise.then((content) => {\n        this.fiber\n          ? requestIdleCallback(() => insertScriptToIframe({ ...scriptResult, content }, iframeWindow))\n          : insertScriptToIframe({ ...scriptResult, content }, iframeWindow);\n      });\n    });\n\n    //框架主动调用mount方法\n    this.execQueue.push(this.fiber ? () => requestIdleCallback(() => this.mount()) : () => this.mount());\n\n    //触发 DOMContentLoaded 事件\n    const domContentLoadedTrigger = () => {\n      eventTrigger(iframeWindow.document, \"DOMContentLoaded\");\n      eventTrigger(iframeWindow, \"DOMContentLoaded\");\n      this.execQueue.shift()?.();\n    };\n    this.execQueue.push(this.fiber ? () => requestIdleCallback(domContentLoadedTrigger) : domContentLoadedTrigger);\n\n    // 插入代码后\n    afterScriptResultList.forEach((afterScriptResult) => {\n      this.execQueue.push(() =>\n        this.fiber\n          ? requestIdleCallback(() => insertScriptToIframe(afterScriptResult, iframeWindow))\n          : insertScriptToIframe(afterScriptResult, iframeWindow)\n      );\n    });\n\n    //触发 loaded 事件\n    const domLoadedTrigger = () => {\n      eventTrigger(iframeWindow.document, \"readystatechange\");\n      eventTrigger(iframeWindow, \"load\");\n      this.execQueue.shift()?.();\n    };\n    this.execQueue.push(this.fiber ? () => requestIdleCallback(domLoadedTrigger) : domLoadedTrigger);\n    // 由于没有办法准确定位是哪个代码做了mount，保活、重建模式提前关闭loading\n    if (this.alive || !isFunction(this.iframe.contentWindow.__WUJIE_UNMOUNT)) removeLoading(this.el);\n    this.execQueue.shift()();\n\n    // 所有的execQueue队列执行完毕，start才算结束，保证串行的执行子应用\n    return new Promise((resolve) => {\n      this.execQueue.push(() => {\n        resolve();\n        this.execQueue.shift()?.();\n      });\n    });\n  }\n\n  /**\n   * 框架主动发起mount，如果子应用是异步渲染实例，比如将生命周__WUJIE_MOUNT放到async函数内\n   * 此时如果采用fiber模式渲染（主应用调用mount的时机也是异步不确定的），框架调用mount时可能\n   * 子应用的__WUJIE_MOUNT还没有挂载到window，所以这里封装一个mount函数，当子应用是异步渲染\n   * 实例时，子应用异步函数里面最后加上window.__WUJIE.mount()来主动调用\n   */\n  public mount(): void {\n    if (this.mountFlag) return;\n    if (isFunction(this.iframe.contentWindow.__WUJIE_MOUNT)) {\n      removeLoading(this.el);\n      this.lifecycles?.beforeMount?.(this.iframe.contentWindow);\n      this.iframe.contentWindow.__WUJIE_MOUNT();\n      this.lifecycles?.afterMount?.(this.iframe.contentWindow);\n      this.mountFlag = true;\n    }\n    if (this.alive) {\n      this.lifecycles?.activated?.(this.iframe.contentWindow);\n    }\n    this.execQueue.shift()?.();\n  }\n\n  /** 保活模式和使用proxyLocation.href跳转链接都不应该销毁shadow */\n  public unmount(): void {\n    this.activeFlag = false;\n    // 清理子应用过期的同步参数\n    clearInactiveAppUrl();\n    if (this.alive) {\n      this.lifecycles?.deactivated?.(this.iframe.contentWindow);\n    }\n    if (!this.mountFlag) return;\n    if (isFunction(this.iframe.contentWindow.__WUJIE_UNMOUNT) && !this.alive && !this.hrefFlag) {\n      this.lifecycles?.beforeUnmount?.(this.iframe.contentWindow);\n      this.iframe.contentWindow.__WUJIE_UNMOUNT();\n      this.lifecycles?.afterUnmount?.(this.iframe.contentWindow);\n      this.mountFlag = false;\n      this.bus.$clear();\n      if (!this.degrade) {\n        clearChild(this.shadowRoot);\n        // head body需要复用，每次都要清空事件\n        removeEventListener(this.head);\n        removeEventListener(this.body);\n      }\n      clearChild(this.head);\n      clearChild(this.body);\n    }\n  }\n\n  /** 销毁子应用 */\n  public destroy() {\n    this.bus.$clear();\n    this.shadowRoot = null;\n    this.proxy = null;\n    this.proxyDocument = null;\n    this.proxyLocation = null;\n    this.execQueue = null;\n    this.provide = null;\n    this.degradeAttrs = null;\n    this.styleSheetElements = null;\n    this.bus = null;\n    this.replace = null;\n    this.fetch = null;\n    this.execFlag = null;\n    this.mountFlag = null;\n    this.hrefFlag = null;\n    this.document = null;\n    this.head = null;\n    this.body = null;\n    this.elementEventCacheMap = null;\n    this.lifecycles = null;\n    this.plugins = null;\n    this.provide = null;\n    this.inject = null;\n    this.execQueue = null;\n    this.prefix = null;\n    // 清除 dom\n    if (this.el) {\n      clearChild(this.el);\n      this.el = null;\n    }\n    // 清除 iframe 沙箱\n    if (this.iframe) {\n      this.iframe.parentNode?.removeChild(this.iframe);\n    }\n    deleteWujieById(this.id);\n  }\n\n  /** 当子应用再次激活后，只运行mount函数，样式需要重新恢复 */\n  public rebuildStyleSheets(): void {\n    if (this.styleSheetElements && this.styleSheetElements.length) {\n      this.styleSheetElements.forEach((styleSheetElement) => {\n        rawElementAppendChild.call(this.degrade ? this.document.head : this.shadowRoot.head, styleSheetElement);\n      });\n    }\n    this.patchCssRules();\n  }\n\n  /**\n   * 子应用样式打补丁\n   * 1、兼容:root选择器样式到:host选择器上\n   * 2、将@font-face定义到shadowRoot外部\n   */\n  public patchCssRules(): void {\n    if (this.degrade) return;\n    if (this.shadowRoot.host.hasAttribute(WUJIE_DATA_ATTACH_CSS_FLAG)) return;\n    const [hostStyleSheetElement, fontStyleSheetElement] = getPatchStyleElements(\n      Array.from(this.iframe.contentDocument.querySelectorAll(\"style\")).map(\n        (styleSheetElement) => styleSheetElement.sheet\n      )\n    );\n    if (hostStyleSheetElement) {\n      this.shadowRoot.head.appendChild(hostStyleSheetElement);\n      this.styleSheetElements.push(hostStyleSheetElement);\n    }\n    if (fontStyleSheetElement) {\n      this.shadowRoot.host.appendChild(fontStyleSheetElement);\n    }\n    (hostStyleSheetElement || fontStyleSheetElement) &&\n      this.shadowRoot.host.setAttribute(WUJIE_DATA_ATTACH_CSS_FLAG, \"\");\n  }\n\n  /**\n   * @param id 子应用的id，唯一标识\n   * @param url 子应用的url，可以包含protocol、host、path、query、hash\n   */\n  constructor(options: {\n    name: string;\n    url: string;\n    attrs: { [key: string]: any };\n    degradeAttrs: { [key: string]: any };\n    fiber: boolean;\n    degrade;\n    plugins: Array<plugin>;\n    lifecycles: lifecycles;\n  }) {\n    // 传递inject给嵌套子应用\n    if (window.__POWERED_BY_WUJIE__) this.inject = window.__WUJIE.inject;\n    else {\n      this.inject = {\n        idToSandboxMap: idToSandboxCacheMap,\n        appEventObjMap,\n        mainHostPath: window.location.protocol + \"//\" + window.location.host,\n      };\n    }\n    const { name, url, attrs, fiber, degradeAttrs, degrade, lifecycles, plugins } = options;\n    this.id = name;\n    this.fiber = fiber;\n    this.degrade = degrade || !wujieSupport;\n    this.bus = new EventBus(this.id);\n    this.url = url;\n    this.degradeAttrs = degradeAttrs;\n    this.provide = { bus: this.bus };\n    this.styleSheetElements = [];\n    this.execQueue = [];\n    this.lifecycles = lifecycles;\n    this.plugins = getPlugins(plugins);\n\n    // 创建目标地址的解析\n    const { urlElement, appHostPath, appRoutePath } = appRouteParse(url);\n    const { mainHostPath } = this.inject;\n    // 创建iframe\n    this.iframe = iframeGenerator(this, attrs, mainHostPath, appHostPath, appRoutePath);\n\n    if (this.degrade) {\n      const { proxyDocument, proxyLocation } = localGenerator(this.iframe, urlElement, mainHostPath, appHostPath);\n      this.proxyDocument = proxyDocument;\n      this.proxyLocation = proxyLocation;\n    } else {\n      const { proxyWindow, proxyDocument, proxyLocation } = proxyGenerator(\n        this.iframe,\n        urlElement,\n        mainHostPath,\n        appHostPath\n      );\n      this.proxy = proxyWindow;\n      this.proxyDocument = proxyDocument;\n      this.proxyLocation = proxyLocation;\n    }\n    this.provide.location = this.proxyLocation;\n\n    addSandboxCacheWithWujie(this.id, this);\n  }\n}\n"],"mappings":";;;;;;;;;;;AAAA,SACEA,eADF,EAEEC,qBAFF,EAGEC,wBAHF,EAIEC,oBAJF,EAKEC,mBALF,QAMO,UANP;AAOA,SAASC,eAAT,EAA0BC,eAA1B,EAA2CC,mBAA3C,QAAsE,QAAtE;AACA,SACEC,uBADF,EAEEC,UAFF,EAGEC,qBAHF,EAIEC,wBAJF,EAKEC,0BALF,EAMEC,sBANF,EAOEC,4BAPF,EAQEC,aARF,QASO,UATP;AAUA,SAASC,cAAT,EAAyBC,cAAzB,QAA+C,SAA/C;AAEA,SAASC,UAAT,EAAqBC,gBAArB,QAA6C,UAA7C;AACA,SAASC,mBAAT,QAAoC,UAApC;AACA,SAEEC,mBAFF,EAGEC,wBAHF,EAIEC,eAJF,EAKEC,qBALF,EAMEC,wBANF,QAOO,UAPP;AAQA,SAASC,QAAT,EAAmBC,cAAnB,QAAmD,SAAnD;AACA,SAASC,UAAT,EAAqBC,YAArB,EAAmCC,aAAnC,EAAkDC,mBAAlD,EAAuEC,eAAvE,EAAwFC,YAAxF,QAA4G,SAA5G;AACA,SAASC,0BAAT,QAA2C,YAA3C;;AAcA;AACA;AACA;IACqBC,K;EAuZnB;AACF;AACA;AACA;EACE,eAAYC,OAAZ,EASG;IAAA;;IAAA,8CAlWC,IAAIC,OAAJ,EAkWD;;IACD;IACA,IAAIC,MAAM,CAACC,oBAAX,EAAiC,KAAKC,MAAL,GAAcF,MAAM,CAACG,OAAP,CAAeD,MAA7B,CAAjC,KACK;MACH,KAAKA,MAAL,GAAc;QACZE,cAAc,EAAErB,mBADJ;QAEZM,cAAc,EAAdA,cAFY;QAGZgB,YAAY,EAAEL,MAAM,CAACM,QAAP,CAAgBC,QAAhB,GAA2B,IAA3B,GAAkCP,MAAM,CAACM,QAAP,CAAgBE;MAHpD,CAAd;IAKD;IACD,IAAQC,IAAR,GAAgFX,OAAhF,CAAQW,IAAR;IAAA,IAAcC,GAAd,GAAgFZ,OAAhF,CAAcY,GAAd;IAAA,IAAmBC,KAAnB,GAAgFb,OAAhF,CAAmBa,KAAnB;IAAA,IAA0BC,KAA1B,GAAgFd,OAAhF,CAA0Bc,KAA1B;IAAA,IAAiCC,YAAjC,GAAgFf,OAAhF,CAAiCe,YAAjC;IAAA,IAA+CC,OAA/C,GAAgFhB,OAAhF,CAA+CgB,OAA/C;IAAA,IAAwDC,UAAxD,GAAgFjB,OAAhF,CAAwDiB,UAAxD;IAAA,IAAoEC,OAApE,GAAgFlB,OAAhF,CAAoEkB,OAApE;IACA,KAAKC,EAAL,GAAUR,IAAV;IACA,KAAKG,KAAL,GAAaA,KAAb;IACA,KAAKE,OAAL,GAAeA,OAAO,IAAI,CAACvB,YAA3B;IACA,KAAK2B,GAAL,GAAW,IAAI9B,QAAJ,CAAa,KAAK6B,EAAlB,CAAX;IACA,KAAKP,GAAL,GAAWA,GAAX;IACA,KAAKG,YAAL,GAAoBA,YAApB;IACA,KAAKM,OAAL,GAAe;MAAED,GAAG,EAAE,KAAKA;IAAZ,CAAf;IACA,KAAKE,kBAAL,GAA0B,EAA1B;IACA,KAAKC,SAAL,GAAiB,EAAjB;IACA,KAAKN,UAAL,GAAkBA,UAAlB;IACA,KAAKC,OAAL,GAAepC,UAAU,CAACoC,OAAD,CAAzB,CArBC,CAuBD;;IACA,qBAAkDxB,aAAa,CAACkB,GAAD,CAA/D;IAAA,IAAQY,UAAR,kBAAQA,UAAR;IAAA,IAAoBC,WAApB,kBAAoBA,WAApB;IAAA,IAAiCC,YAAjC,kBAAiCA,YAAjC;;IACA,IAAQnB,YAAR,GAAyB,KAAKH,MAA9B,CAAQG,YAAR,CAzBC,CA0BD;;IACA,KAAKoB,MAAL,GAAc/D,eAAe,CAAC,IAAD,EAAOiD,KAAP,EAAcN,YAAd,EAA4BkB,WAA5B,EAAyCC,YAAzC,CAA7B;;IAEA,IAAI,KAAKV,OAAT,EAAkB;MAChB,sBAAyCnC,cAAc,CAAC,KAAK8C,MAAN,EAAcH,UAAd,EAA0BjB,YAA1B,EAAwCkB,WAAxC,CAAvD;MAAA,IAAQG,aAAR,mBAAQA,aAAR;MAAA,IAAuBC,aAAvB,mBAAuBA,aAAvB;;MACA,KAAKD,aAAL,GAAqBA,aAArB;MACA,KAAKC,aAAL,GAAqBA,aAArB;IACD,CAJD,MAIO;MACL,sBAAsDjD,cAAc,CAClE,KAAK+C,MAD6D,EAElEH,UAFkE,EAGlEjB,YAHkE,EAIlEkB,WAJkE,CAApE;MAAA,IAAQK,WAAR,mBAAQA,WAAR;MAAA,IAAqBF,cAArB,mBAAqBA,aAArB;MAAA,IAAoCC,cAApC,mBAAoCA,aAApC;;MAMA,KAAKE,KAAL,GAAaD,WAAb;MACA,KAAKF,aAAL,GAAqBA,cAArB;MACA,KAAKC,aAAL,GAAqBA,cAArB;IACD;;IACD,KAAKR,OAAL,CAAab,QAAb,GAAwB,KAAKqB,aAA7B;IAEA3C,wBAAwB,CAAC,KAAKiC,EAAN,EAAU,IAAV,CAAxB;EACD;;;;;IAjdD;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAEA;;IAqBA;AACF;AACA;AACA;AACA;AACA;;6EACE,iBAAoBnB,OAApB;QAAA;;QAAA;;QAAA;UAAA;YAAA;cAAA;gBAWUgC,IAXV,GAW4EhC,OAX5E,CAWUgC,IAXV,EAWgBpB,GAXhB,GAW4EZ,OAX5E,CAWgBY,GAXhB,EAWqBqB,EAXrB,GAW4EjC,OAX5E,CAWqBiC,EAXrB,EAWyBC,QAXzB,GAW4ElC,OAX5E,CAWyBkC,QAXzB,EAWmCC,KAXnC,GAW4EnC,OAX5E,CAWmCmC,KAXnC,EAW0CC,KAX1C,GAW4EpC,OAX5E,CAW0CoC,KAX1C,EAWiDC,MAXjD,GAW4ErC,OAX5E,CAWiDqC,MAXjD,EAWyDC,KAXzD,GAW4EtC,OAX5E,CAWyDsC,KAXzD,EAWgEC,OAXhE,GAW4EvC,OAX5E,CAWgEuC,OAXhE;gBAYE,KAAK3B,GAAL,GAAWA,GAAX;gBACA,KAAKoB,IAAL,GAAYA,IAAZ;gBACA,KAAKI,KAAL,GAAaA,KAAb;gBACA,KAAKI,QAAL,GAAgB,KAAhB;gBACA,KAAKH,MAAL,GAAcA,MAAd,aAAcA,MAAd,cAAcA,MAAd,GAAwB,KAAKA,MAA7B;gBACA,KAAKE,OAAL,GAAeA,OAAf,aAAeA,OAAf,cAAeA,OAAf,GAA0B,KAAKA,OAA/B;gBACA,KAAKlB,OAAL,CAAac,KAAb,GAAqBA,KAArB,aAAqBA,KAArB,cAAqBA,KAArB,GAA8B,KAAKd,OAAL,CAAac,KAA3C;gBACA,KAAKM,UAAL,GAAkB,IAAlB,CAnBF,CAoBE;;gBApBF;gBAAA,OAqBQ,KAAKC,WArBb;;cAAA;gBAuBE;gBACA;gBACMC,YAzBR,GAyBuB,KAAKhB,MAAL,CAAYiB,aAzBnC;gBA0BQC,WA1BR,GA0BsBP,KAAK,GACrB,UAACQ,KAAD,EAAqBC,IAArB;kBAAA,OACET,KAAK,CAAC,OAAOQ,KAAP,KAAiB,QAAjB,GAA4BlD,eAAe,CAACkD,KAAD,EAAS,KAAI,CAACjB,aAAN,CAAiCmB,IAAzC,CAA3C,GAA4FF,KAA7F,EAAoGC,IAApG,CADP;gBAAA,CADqB,GAGrB,KAAKT,KA7BX;;gBA8BE,IAAIO,WAAJ,EAAiB;kBACfF,YAAY,CAACL,KAAb,GAAqBO,WAArB;kBACA,KAAKP,KAAL,GAAaO,WAAb;gBACD,CAjCH,CAmCE;;;gBACA,IAAI,KAAKI,QAAL,IAAiB,KAAKb,KAA1B,EAAiC;kBAC/B;kBACAnE,eAAe,CAAC0E,YAAD,CAAf;gBACD,CAHD,MAGO;kBACL;kBACAzE,eAAe,CAACyE,YAAD,CAAf;kBACA1E,eAAe,CAAC0E,YAAD,CAAf;gBACD,CA3CH,CA6CE;;;gBACA,KAAKT,QAAL,GAAgBA,QAAhB,aAAgBA,QAAhB,cAAgBA,QAAhB,GAA4B,KAAKA,QAAjC;gBAEA;;gBAhDF,KAiDM,KAAKlB,OAjDX;kBAAA;kBAAA;gBAAA;;gBAkDUkC,UAlDV,GAkDuB7D,wBAAwB,CAAC8D,IAAzB,CAA8BR,YAAY,CAACS,QAA3C,EAAqD,MAArD,CAlDvB;gBAAA,wBAmDkC1E,4BAA4B,CAAC,KAAKyC,EAAN,EAAUc,EAAV,aAAUA,EAAV,cAAUA,EAAV,GAAgBiB,UAAhB,EAA4B,KAAKnC,YAAjC,CAnD9D,EAmDYY,MAnDZ,yBAmDYA,MAnDZ,EAmDoB0B,SAnDpB,yBAmDoBA,SAnDpB;gBAoDI,KAAKpB,EAAL,GAAUoB,SAAV,CApDJ,CAqDI;;gBACA,IAAIpB,EAAJ,EAAQ5D,UAAU,CAAC6E,UAAD,CAAV,CAtDZ,CAuDI;;gBACAlF,mBAAmB,CAAC2D,MAAM,CAACiB,aAAR,EAAuBD,YAAvB,CAAnB,CAxDJ,CAyDI;;gBACAhB,MAAM,CAACiB,aAAP,CAAqBU,QAArB,GAAgC,YAAM;kBACpC,KAAI,CAACC,OAAL;gBACD,CAFD;;gBA1DJ,KA6DQ,KAAKH,QA7Db;kBAAA;kBAAA;gBAAA;;gBAAA,KA8DU,KAAKhB,KA9Df;kBAAA;kBAAA;gBAAA;;gBA+DQT,MAAM,CAAC6B,eAAP,CAAuBC,YAAvB,CAAoC,KAAKL,QAAL,CAAcM,eAAlD,EAAmE/B,MAAM,CAAC6B,eAAP,CAAuBE,eAA1F,EA/DR,CAgEQ;;gBACA7F,qBAAqB,CAAC8D,MAAM,CAAC6B,eAAP,CAAuBE,eAAxB,EAAyCf,YAAzC,CAArB;gBAjER;gBAAA;;cAAA;gBAAA;gBAAA,OAmEclE,sBAAsB,CAACkD,MAAM,CAAC6B,eAAR,EAAyB,KAAK7B,MAAL,CAAYiB,aAArC,EAAoD,KAAKV,QAAzD,CAnEpC;;cAAA;gBAoEQ;gBACApE,wBAAwB,CAAC,KAAKsF,QAAL,CAAcM,eAAf,EAAgC/B,MAAM,CAAC6B,eAAP,CAAuBE,eAAvD,EAAwEf,YAAxE,CAAxB;;cArER;gBAAA;gBAAA;;cAAA;gBAAA;gBAAA,OAwEYlE,sBAAsB,CAACkD,MAAM,CAAC6B,eAAR,EAAyB,KAAK7B,MAAL,CAAYiB,aAArC,EAAoD,KAAKV,QAAzD,CAxElC;;cAAA;gBA0EI,KAAKkB,QAAL,GAAgBzB,MAAM,CAAC6B,eAAvB;gBA1EJ;;cAAA;gBAAA,KA8EM,KAAKG,UA9EX;kBAAA;kBAAA;gBAAA;;gBA+EI;AACN;AACA;AACA;AACA;AACA;gBACM,KAAK1B,EAAL,GAAU1D,wBAAwB,CAAC,KAAKoF,UAAL,CAAgBjD,IAAjB,EAAuBuB,EAAvB,CAAlC;;gBArFJ,KAsFQ,KAAKG,KAtFb;kBAAA;kBAAA;gBAAA;;gBAAA;;cAAA;gBAAA;gBAAA;;cAAA;gBAwFI;gBACMc,WAzFV,GAyFuB7D,wBAAwB,CAAC8D,IAAzB,CAA8BR,YAAY,CAACS,QAA3C,EAAqD,MAArD,CAzFvB;gBA0FI,KAAKnB,EAAL,GAAU1D,wBAAwB,CAACH,uBAAuB,CAAC,KAAK+C,EAAN,CAAxB,EAAmCc,EAAnC,aAAmCA,EAAnC,cAAmCA,EAAnC,GAAyCiB,WAAzC,CAAlC;;cA1FJ;gBAAA;gBAAA,OA6FQ1E,0BAA0B,CAAC,KAAKmF,UAAN,EAAkBhB,YAAlB,EAAgC,KAAKT,QAArC,CA7FlC;;cAAA;gBA8FE,KAAK0B,aAAL,GA9FF,CAgGE;;gBACA,KAAKvC,OAAL,CAAasC,UAAb,GAA0B,KAAKA,UAA/B;;cAjGF;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,C;;;;;;;;IAoGA;AACF;AACA;AACA;;;;;4EACE,kBAAmBE,kBAAnB;QAAA;;QAAA;QAAA;UAAA;YAAA;cAAA;gBACE,KAAKZ,QAAL,GAAgB,IAAhB,CADF,CAEE;;gBAFF;gBAAA,OAGiCY,kBAAkB,EAHnD;;cAAA;gBAGQC,gBAHR;;gBAAA,IAKO,KAAKnC,MALZ;kBAAA;kBAAA;gBAAA;;gBAAA;;cAAA;gBAMQgB,YANR,GAMuB,KAAKhB,MAAL,CAAYiB,aANnC,EAOE;;gBACAD,YAAY,CAACxC,oBAAb,GAAoC,IAApC,CARF,CASE;;gBACM4D,sBAVR,GAUuDhF,gBAAgB,CAAC,iBAAD,EAAoB,KAAKmC,OAAzB,CAVvE,EAWE;;gBACM8C,qBAZR,GAYsDjF,gBAAgB,CAAC,gBAAD,EAAmB,KAAKmC,OAAxB,CAZtE,EAaE;;gBACM+C,oBAdR,GAciD,EAdjD,EAeE;;gBACMC,qBAhBR,GAgBkD,EAhBlD,EAiBE;;gBACMC,qBAlBR,GAkBkD,EAlBlD;gBAmBEL,gBAAgB,CAACM,OAAjB,CAAyB,UAACC,YAAD,EAAkB;kBACzC,IAAIA,YAAY,CAACC,KAAjB,EAAwBH,qBAAqB,CAACI,IAAtB,CAA2BF,YAA3B,EAAxB,KACK,IAAIA,YAAY,CAACG,KAAjB,EAAwBN,qBAAqB,CAACK,IAAtB,CAA2BF,YAA3B,EAAxB,KACAJ,oBAAoB,CAACM,IAArB,CAA0BF,YAA1B;gBACN,CAJD,EAnBF,CAyBE;;gBACAN,sBAAsB,CAACK,OAAvB,CAA+B,UAACK,kBAAD,EAAwB;kBACrD,MAAI,CAAClD,SAAL,CAAegD,IAAf,CAAoB;oBAAA,OAClB,MAAI,CAACzD,KAAL,GACInB,mBAAmB,CAAC;sBAAA,OAAM5B,oBAAoB,CAAC0G,kBAAD,EAAqB9B,YAArB,CAA1B;oBAAA,CAAD,CADvB,GAEI5E,oBAAoB,CAAC0G,kBAAD,EAAqB9B,YAArB,CAHN;kBAAA,CAApB;gBAKD,CAND,EA1BF,CAkCE;;gBACAsB,oBAAoB,CAACS,MAArB,CAA4BP,qBAA5B,EAAmDC,OAAnD,CAA2D,UAACC,YAAD,EAAkB;kBAC3E,MAAI,CAAC9C,SAAL,CAAegD,IAAf,CAAoB;oBAAA,OAClBF,YAAY,CAACM,cAAb,CAA4BC,IAA5B,CAAiC,UAACC,OAAD;sBAAA,OAC/B,MAAI,CAAC/D,KAAL,GACInB,mBAAmB,CAAC;wBAAA,OAAM5B,oBAAoB,iCAAMsG,YAAN;0BAAoBQ,OAAO,EAAPA;wBAApB,IAA+BlC,YAA/B,CAA1B;sBAAA,CAAD,CADvB,GAEI5E,oBAAoB,iCAAMsG,YAAN;wBAAoBQ,OAAO,EAAPA;sBAApB,IAA+BlC,YAA/B,CAHO;oBAAA,CAAjC,CADkB;kBAAA,CAApB;gBAOD,CARD,EAnCF,CA6CE;;gBACAuB,qBAAqB,CAACE,OAAtB,CAA8B,UAACC,YAAD,EAAkB;kBAC9CA,YAAY,CAACM,cAAb,CAA4BC,IAA5B,CAAiC,UAACC,OAAD,EAAa;oBAC5C,MAAI,CAAC/D,KAAL,GACInB,mBAAmB,CAAC;sBAAA,OAAM5B,oBAAoB,iCAAMsG,YAAN;wBAAoBQ,OAAO,EAAPA;sBAApB,IAA+BlC,YAA/B,CAA1B;oBAAA,CAAD,CADvB,GAEI5E,oBAAoB,iCAAMsG,YAAN;sBAAoBQ,OAAO,EAAPA;oBAApB,IAA+BlC,YAA/B,CAFxB;kBAGD,CAJD;gBAKD,CAND,EA9CF,CAsDE;;gBACA,KAAKpB,SAAL,CAAegD,IAAf,CAAoB,KAAKzD,KAAL,GAAa;kBAAA,OAAMnB,mBAAmB,CAAC;oBAAA,OAAM,MAAI,CAACmF,KAAL,EAAN;kBAAA,CAAD,CAAzB;gBAAA,CAAb,GAA6D;kBAAA,OAAM,MAAI,CAACA,KAAL,EAAN;gBAAA,CAAjF,EAvDF,CAyDE;;gBACMC,uBA1DR,GA0DkC,SAA1BA,uBAA0B,GAAM;kBAAA;;kBACpClF,YAAY,CAAC8C,YAAY,CAACS,QAAd,EAAwB,kBAAxB,CAAZ;kBACAvD,YAAY,CAAC8C,YAAD,EAAe,kBAAf,CAAZ;kBACA,+BAAI,CAACpB,SAAL,CAAeyD,KAAf;gBACD,CA9DH;;gBA+DE,KAAKzD,SAAL,CAAegD,IAAf,CAAoB,KAAKzD,KAAL,GAAa;kBAAA,OAAMnB,mBAAmB,CAACoF,uBAAD,CAAzB;gBAAA,CAAb,GAAkEA,uBAAtF,EA/DF,CAiEE;;gBACAf,qBAAqB,CAACI,OAAtB,CAA8B,UAACa,iBAAD,EAAuB;kBACnD,MAAI,CAAC1D,SAAL,CAAegD,IAAf,CAAoB;oBAAA,OAClB,MAAI,CAACzD,KAAL,GACInB,mBAAmB,CAAC;sBAAA,OAAM5B,oBAAoB,CAACkH,iBAAD,EAAoBtC,YAApB,CAA1B;oBAAA,CAAD,CADvB,GAEI5E,oBAAoB,CAACkH,iBAAD,EAAoBtC,YAApB,CAHN;kBAAA,CAApB;gBAKD,CAND,EAlEF,CA0EE;;gBACMuC,gBA3ER,GA2E2B,SAAnBA,gBAAmB,GAAM;kBAAA;;kBAC7BrF,YAAY,CAAC8C,YAAY,CAACS,QAAd,EAAwB,kBAAxB,CAAZ;kBACAvD,YAAY,CAAC8C,YAAD,EAAe,MAAf,CAAZ;kBACA,gCAAI,CAACpB,SAAL,CAAeyD,KAAf;gBACD,CA/EH;;gBAgFE,KAAKzD,SAAL,CAAegD,IAAf,CAAoB,KAAKzD,KAAL,GAAa;kBAAA,OAAMnB,mBAAmB,CAACuF,gBAAD,CAAzB;gBAAA,CAAb,GAA2DA,gBAA/E,EAhFF,CAiFE;;gBACA,IAAI,KAAK9C,KAAL,IAAc,CAAC5C,UAAU,CAAC,KAAKmC,MAAL,CAAYiB,aAAZ,CAA0BuC,eAA3B,CAA7B,EAA0ExG,aAAa,CAAC,KAAKsD,EAAN,CAAb;gBAC1E,KAAKV,SAAL,CAAeyD,KAAf,KAnFF,CAqFE;;gBArFF,kCAsFS,IAAII,OAAJ,CAAY,UAACC,OAAD,EAAa;kBAC9B,MAAI,CAAC9D,SAAL,CAAegD,IAAf,CAAoB,YAAM;oBAAA;;oBACxBc,OAAO;oBACP,gCAAI,CAAC9D,SAAL,CAAeyD,KAAf;kBACD,CAHD;gBAID,CALM,CAtFT;;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,C;;;;;;;;IA8FA;AACF;AACA;AACA;AACA;AACA;;;;WACE,iBAAqB;MAAA;;MACnB,IAAI,KAAKM,SAAT,EAAoB;;MACpB,IAAI9F,UAAU,CAAC,KAAKmC,MAAL,CAAYiB,aAAZ,CAA0B2C,aAA3B,CAAd,EAAyD;QAAA;;QACvD5G,aAAa,CAAC,KAAKsD,EAAN,CAAb;QACA,yBAAKhB,UAAL,+FAAiBuE,WAAjB,uGAA+B,KAAK7D,MAAL,CAAYiB,aAA3C;;QACA,KAAKjB,MAAL,CAAYiB,aAAZ,CAA0B2C,aAA1B;;QACA,0BAAKtE,UAAL,iGAAiBwE,UAAjB,wGAA8B,KAAK9D,MAAL,CAAYiB,aAA1C;QACA,KAAK0C,SAAL,GAAiB,IAAjB;MACD;;MACD,IAAI,KAAKlD,KAAT,EAAgB;QAAA;;QACd,0BAAKnB,UAAL,iGAAiByE,SAAjB,wGAA6B,KAAK/D,MAAL,CAAYiB,aAAzC;MACD;;MACD,8BAAKrB,SAAL,CAAeyD,KAAf;IACD;IAED;;;;WACA,mBAAuB;MACrB,KAAKvC,UAAL,GAAkB,KAAlB,CADqB,CAErB;;MACAtE,mBAAmB;;MACnB,IAAI,KAAKiE,KAAT,EAAgB;QAAA;;QACd,0BAAKnB,UAAL,iGAAiB0E,WAAjB,wGAA+B,KAAKhE,MAAL,CAAYiB,aAA3C;MACD;;MACD,IAAI,CAAC,KAAK0C,SAAV,EAAqB;;MACrB,IAAI9F,UAAU,CAAC,KAAKmC,MAAL,CAAYiB,aAAZ,CAA0BuC,eAA3B,CAAV,IAAyD,CAAC,KAAK/C,KAA/D,IAAwE,CAAC,KAAKI,QAAlF,EAA4F;QAAA;;QAC1F,0BAAKvB,UAAL,iGAAiB2E,aAAjB,wGAAiC,KAAKjE,MAAL,CAAYiB,aAA7C;;QACA,KAAKjB,MAAL,CAAYiB,aAAZ,CAA0BuC,eAA1B;;QACA,0BAAKlE,UAAL,iGAAiB4E,YAAjB,wGAAgC,KAAKlE,MAAL,CAAYiB,aAA5C;QACA,KAAK0C,SAAL,GAAiB,KAAjB;QACA,KAAKlE,GAAL,CAAS0E,MAAT;;QACA,IAAI,CAAC,KAAK9E,OAAV,EAAmB;UACjB3C,UAAU,CAAC,KAAKsF,UAAN,CAAV,CADiB,CAEjB;;UACA3E,mBAAmB,CAAC,KAAK+G,IAAN,CAAnB;UACA/G,mBAAmB,CAAC,KAAKgH,IAAN,CAAnB;QACD;;QACD3H,UAAU,CAAC,KAAK0H,IAAN,CAAV;QACA1H,UAAU,CAAC,KAAK2H,IAAN,CAAV;MACD;IACF;IAED;;;;WACA,mBAAiB;MACf,KAAK5E,GAAL,CAAS0E,MAAT;MACA,KAAKnC,UAAL,GAAkB,IAAlB;MACA,KAAK5B,KAAL,GAAa,IAAb;MACA,KAAKH,aAAL,GAAqB,IAArB;MACA,KAAKC,aAAL,GAAqB,IAArB;MACA,KAAKN,SAAL,GAAiB,IAAjB;MACA,KAAKF,OAAL,GAAe,IAAf;MACA,KAAKN,YAAL,GAAoB,IAApB;MACA,KAAKO,kBAAL,GAA0B,IAA1B;MACA,KAAKF,GAAL,GAAW,IAAX;MACA,KAAKmB,OAAL,GAAe,IAAf;MACA,KAAKD,KAAL,GAAa,IAAb;MACA,KAAKW,QAAL,GAAgB,IAAhB;MACA,KAAKqC,SAAL,GAAiB,IAAjB;MACA,KAAK9C,QAAL,GAAgB,IAAhB;MACA,KAAKY,QAAL,GAAgB,IAAhB;MACA,KAAK2C,IAAL,GAAY,IAAZ;MACA,KAAKC,IAAL,GAAY,IAAZ;MACA,KAAKC,oBAAL,GAA4B,IAA5B;MACA,KAAKhF,UAAL,GAAkB,IAAlB;MACA,KAAKC,OAAL,GAAe,IAAf;MACA,KAAKG,OAAL,GAAe,IAAf;MACA,KAAKjB,MAAL,GAAc,IAAd;MACA,KAAKmB,SAAL,GAAiB,IAAjB;MACA,KAAKc,MAAL,GAAc,IAAd,CAzBe,CA0Bf;;MACA,IAAI,KAAKJ,EAAT,EAAa;QACX5D,UAAU,CAAC,KAAK4D,EAAN,CAAV;QACA,KAAKA,EAAL,GAAU,IAAV;MACD,CA9Bc,CA+Bf;;;MACA,IAAI,KAAKN,MAAT,EAAiB;QAAA;;QACf,8BAAKA,MAAL,CAAYuE,UAAZ,gFAAwBC,WAAxB,CAAoC,KAAKxE,MAAzC;MACD;;MACDxC,eAAe,CAAC,KAAKgC,EAAN,CAAf;IACD;IAED;;;;WACA,8BAAkC;MAAA;;MAChC,IAAI,KAAKG,kBAAL,IAA2B,KAAKA,kBAAL,CAAwB8E,MAAvD,EAA+D;QAC7D,KAAK9E,kBAAL,CAAwB8C,OAAxB,CAAgC,UAACiC,iBAAD,EAAuB;UACrDjH,qBAAqB,CAAC+D,IAAtB,CAA2B,MAAI,CAACnC,OAAL,GAAe,MAAI,CAACoC,QAAL,CAAc2C,IAA7B,GAAoC,MAAI,CAACpC,UAAL,CAAgBoC,IAA/E,EAAqFM,iBAArF;QACD,CAFD;MAGD;;MACD,KAAKzC,aAAL;IACD;IAED;AACF;AACA;AACA;AACA;;;;WACE,yBAA6B;MAC3B,IAAI,KAAK5C,OAAT,EAAkB;MAClB,IAAI,KAAK2C,UAAL,CAAgBjD,IAAhB,CAAqB4F,YAArB,CAAkCxG,0BAAlC,CAAJ,EAAmE;;MACnE,4BAAuDxB,qBAAqB,CAC1EiI,KAAK,CAACC,IAAN,CAAW,KAAK7E,MAAL,CAAY6B,eAAZ,CAA4BiD,gBAA5B,CAA6C,OAA7C,CAAX,EAAkEC,GAAlE,CACE,UAACL,iBAAD;QAAA,OAAuBA,iBAAiB,CAACM,KAAzC;MAAA,CADF,CAD0E,CAA5E;MAAA;MAAA,IAAOC,qBAAP;MAAA,IAA8BC,qBAA9B;;MAKA,IAAID,qBAAJ,EAA2B;QACzB,KAAKjD,UAAL,CAAgBoC,IAAhB,CAAqBe,WAArB,CAAiCF,qBAAjC;QACA,KAAKtF,kBAAL,CAAwBiD,IAAxB,CAA6BqC,qBAA7B;MACD;;MACD,IAAIC,qBAAJ,EAA2B;QACzB,KAAKlD,UAAL,CAAgBjD,IAAhB,CAAqBoG,WAArB,CAAiCD,qBAAjC;MACD;;MACD,CAACD,qBAAqB,IAAIC,qBAA1B,KACE,KAAKlD,UAAL,CAAgBjD,IAAhB,CAAqBqG,YAArB,CAAkCjH,0BAAlC,EAA8D,EAA9D,CADF;IAED;;;;;;SArZkBC,K"}