{"version":3,"file":"template.js","names":["getInlineCode","ALL_SCRIPT_REGEX","SCRIPT_TAG_REGEX","SCRIPT_SRC_REGEX","SCRIPT_TYPE_REGEX","SCRIPT_ENTRY_REGEX","SCRIPT_ASYNC_REGEX","DEFER_ASYNC_REGEX","SCRIPT_NO_MODULE_REGEX","SCRIPT_MODULE_REGEX","LINK_TAG_REGEX","LINK_PRELOAD_OR_PREFETCH_REGEX","LINK_HREF_REGEX","LINK_AS_FONT","STYLE_TAG_REGEX","STYLE_TYPE_REGEX","STYLE_HREF_REGEX","HTML_COMMENT_REGEX","LINK_IGNORE_REGEX","STYLE_IGNORE_REGEX","SCRIPT_IGNORE_REGEX","CROSS_ORIGIN_REGEX","hasProtocol","url","startsWith","getEntirePath","path","baseURI","URL","toString","isValidJavaScriptType","type","handleTypes","indexOf","parseTagAttributes","TagOuterHTML","pattern","matches","exec","attributesString","attributesPattern","attributesObject","attributeMatches","attributeName","attributeValue","isModuleScriptSupported","s","window","document","createElement","genLinkReplaceSymbol","linkHref","preloadOrPrefetch","getInlineStyleReplaceSymbol","index","genScriptReplaceSymbol","scriptSrc","inlineScriptReplaceSymbol","genIgnoreAssetReplaceSymbol","genModuleScriptReplaceSymbol","moduleSupport","processTpl","tpl","postProcessTemplate","scripts","styles","entry","template","replace","match","styleType","styleHref","styleIgnore","href","newHref","push","src","preloadOrPrefetchType","test","code","content","length","scriptTag","scriptIgnore","isModuleScript","isCrossOriginScript","crossOriginType","moduleScriptIgnore","matchedScriptTypeMatch","matchedScriptType","matchedScriptEntry","matchedScriptSrcMatch","matchedScriptSrc","SyntaxError","isAsyncScript","isDeferScript","async","defer","module","crossorigin","crossoriginType","attrs","isPureCommentBlock","split","every","line","trim","tplResult"],"sources":["../src/template.ts"],"sourcesContent":["import { getInlineCode } from \"./utils\";\n\nconst ALL_SCRIPT_REGEX = /(<script[\\s\\S]*?>)[\\s\\S]*?<\\/script>/gi;\nconst SCRIPT_TAG_REGEX = /<(script)\\s+((?!type=('|\")text\\/ng-template\\3).)*?>.*?<\\/\\1>/is;\nconst SCRIPT_SRC_REGEX = /.*\\ssrc=('|\")?([^>'\"\\s]+)/;\nconst SCRIPT_TYPE_REGEX = /.*\\stype=('|\")?([^>'\"\\s]+)/;\nconst SCRIPT_ENTRY_REGEX = /.*\\sentry\\s*.*/;\nconst SCRIPT_ASYNC_REGEX = /.*\\sasync\\s*.*/;\nconst DEFER_ASYNC_REGEX = /.*\\sdefer\\s*.*/;\nconst SCRIPT_NO_MODULE_REGEX = /.*\\snomodule\\s*.*/;\nconst SCRIPT_MODULE_REGEX = /.*\\stype=('|\")?module('|\")?\\s*.*/;\nconst LINK_TAG_REGEX = /<(link)\\s+.*?>/gis;\nconst LINK_PRELOAD_OR_PREFETCH_REGEX = /\\srel=('|\")?(preload|prefetch|modulepreload)\\1/;\nconst LINK_HREF_REGEX = /.*\\shref=('|\")?([^>'\"\\s]+)/;\nconst LINK_AS_FONT = /.*\\sas=('|\")?font\\1.*/;\nconst STYLE_TAG_REGEX = /<style[^>]*>[\\s\\S]*?<\\/style>/gi;\nconst STYLE_TYPE_REGEX = /\\s+rel=('|\")?stylesheet\\1.*/;\nconst STYLE_HREF_REGEX = /.*\\shref=('|\")?([^>'\"\\s]+)/;\nconst HTML_COMMENT_REGEX = /<!--([\\s\\S]*?)-->/g;\nconst LINK_IGNORE_REGEX = /<link(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\nconst STYLE_IGNORE_REGEX = /<style(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\nconst SCRIPT_IGNORE_REGEX = /<script(\\s+|\\s+.+\\s+)ignore(\\s*|\\s+.*|=.*)>/is;\nconst CROSS_ORIGIN_REGEX = /.*\\scrossorigin=?('|\")?(use-credentials|anonymous)?('|\")?/i;\n\nexport type ScriptAttributes = {\n  [key: string]: string | boolean; // 所有属性都可以是字符串或布尔值类型\n};\n/** 脚本对象 */\nexport interface ScriptBaseObject {\n  /** 脚本地址，内联为空 */\n  src?: string;\n  /** 脚本是否为async执行 */\n  async?: boolean;\n  /** 脚本是否为defer执行 */\n  defer?: boolean;\n  /** 脚本是否为module模块 */\n  module?: boolean;\n  /** 脚本是否设置crossorigin */\n  crossorigin?: boolean;\n  /** 脚本crossorigin的类型 */\n  crossoriginType?: \"anonymous\" | \"use-credentials\" | \"\";\n  /** 脚本正则匹配属性 */\n  attrs?: ScriptAttributes;\n}\nexport type ScriptObject = ScriptBaseObject & {\n  /** 内联script的代码 */\n  content?: string;\n  /** 忽略，子应用自行请求 */\n  ignore?: boolean;\n  /** 子应用加载完毕事件 */\n  onload?: Function;\n};\n\n/** 样式对象 */\nexport interface StyleObject {\n  /** 样式地址， 内联为空 */\n  src?: string;\n  /** 样式代码 */\n  content?: string;\n  /** 忽略，子应用自行请求 */\n  ignore?: boolean;\n}\n\nexport interface TemplateResult {\n  template: string;\n  scripts: ScriptObject[];\n  styles: StyleObject[];\n  entry: string | ScriptObject;\n}\n\nfunction hasProtocol(url) {\n  return url.startsWith(\"//\") || url.startsWith(\"http://\") || url.startsWith(\"https://\");\n}\n\nfunction getEntirePath(path, baseURI) {\n  return new URL(path, baseURI).toString();\n}\n\nfunction isValidJavaScriptType(type) {\n  const handleTypes = [\n    \"text/javascript\",\n    \"module\",\n    \"application/javascript\",\n    \"text/ecmascript\",\n    \"application/ecmascript\",\n  ];\n  return !type || handleTypes.indexOf(type) !== -1;\n}\n\n/**\n * 解析标签的属性\n * @param scriptOuterHTML script 标签的 outerHTML\n * @returns 返回一个对象，包含 script 标签的所有属性\n */\nexport function parseTagAttributes(TagOuterHTML) {\n  const pattern = /<[-\\w]+\\s+([^>]*)>/i;\n  const matches = pattern.exec(TagOuterHTML);\n\n  if (!matches) {\n    return {};\n  }\n\n  const attributesString = matches[1];\n  const attributesPattern = /([^\\s=]+)\\s*=\\s*(['\"])(.*?)\\2/g;\n  const attributesObject = {};\n\n  let attributeMatches;\n  while ((attributeMatches = attributesPattern.exec(attributesString)) !== null) {\n    const attributeName = attributeMatches[1];\n    const attributeValue = attributeMatches[3];\n    attributesObject[attributeName] = attributeValue;\n  }\n\n  return attributesObject;\n}\n\nfunction isModuleScriptSupported() {\n  const s = window.document.createElement(\"script\");\n  return \"noModule\" in s;\n}\n\nexport const genLinkReplaceSymbol = (linkHref, preloadOrPrefetch = false) =>\n  `<!-- ${preloadOrPrefetch ? \"prefetch/preload/modulepreload\" : \"\"} link ${linkHref} replaced by wujie -->`;\nexport const getInlineStyleReplaceSymbol = (index) => `<!-- inline-style-${index} replaced by wujie -->`;\nexport const genScriptReplaceSymbol = (scriptSrc, type = \"\") =>\n  `<!-- ${type} script ${scriptSrc} replaced by wujie -->`;\nexport const inlineScriptReplaceSymbol = \"<!-- inline scripts replaced by wujie -->\";\nexport const genIgnoreAssetReplaceSymbol = (url) => `<!-- ignore asset ${url || \"file\"} replaced by wujie -->`;\nexport const genModuleScriptReplaceSymbol = (scriptSrc, moduleSupport) =>\n  `<!-- ${moduleSupport ? \"nomodule\" : \"module\"} script ${scriptSrc} ignored by wujie -->`;\n\n/**\n * parse the script link from the template\n * 1. collect stylesheets\n * 2. use global eval to evaluate the inline scripts\n *    see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function#Difference_between_Function_constructor_and_function_declaration\n *    see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval#Do_not_ever_use_eval!\n * @param tpl\n * @param baseURI\n * @stripStyles whether to strip the css links\n * @returns {{template: void | string | *, scripts: *[], entry: *}}\n */\nexport default function processTpl(tpl: String, baseURI: String, postProcessTemplate?: Function): TemplateResult {\n  const scripts: ScriptObject[] = [];\n  const styles: StyleObject[] = [];\n  let entry = null;\n  const moduleSupport = isModuleScriptSupported();\n  const template = tpl\n\n    /*\n     remove html comment first\n     */\n    .replace(HTML_COMMENT_REGEX, \"\")\n\n    .replace(LINK_TAG_REGEX, (match) => {\n      /*\n       change the css link\n       */\n      const styleType = !!match.match(STYLE_TYPE_REGEX);\n      if (styleType) {\n        const styleHref = match.match(STYLE_HREF_REGEX);\n        const styleIgnore = match.match(LINK_IGNORE_REGEX);\n\n        if (styleHref) {\n          const href = styleHref && styleHref[2];\n          let newHref = href;\n\n          if (href && !hasProtocol(href)) {\n            newHref = getEntirePath(href, baseURI);\n          }\n          if (styleIgnore) {\n            return genIgnoreAssetReplaceSymbol(newHref);\n          }\n\n          styles.push({ src: newHref });\n          return genLinkReplaceSymbol(newHref);\n        }\n      }\n\n      const preloadOrPrefetchType =\n        match.match(LINK_PRELOAD_OR_PREFETCH_REGEX) && match.match(LINK_HREF_REGEX) && !match.match(LINK_AS_FONT);\n      if (preloadOrPrefetchType) {\n        const [, , linkHref] = match.match(LINK_HREF_REGEX);\n        return genLinkReplaceSymbol(linkHref, true);\n      }\n\n      return match;\n    })\n    .replace(STYLE_TAG_REGEX, (match) => {\n      if (STYLE_IGNORE_REGEX.test(match)) {\n        return genIgnoreAssetReplaceSymbol(\"style file\");\n      } else {\n        const code = getInlineCode(match);\n        styles.push({ src: \"\", content: code });\n        return getInlineStyleReplaceSymbol(styles.length - 1);\n      }\n    })\n    .replace(ALL_SCRIPT_REGEX, (match, scriptTag) => {\n      const scriptIgnore = scriptTag.match(SCRIPT_IGNORE_REGEX);\n      const isModuleScript = !!scriptTag.match(SCRIPT_MODULE_REGEX);\n      const isCrossOriginScript = scriptTag.match(CROSS_ORIGIN_REGEX);\n      const crossOriginType = isCrossOriginScript?.[2] || \"\";\n      const moduleScriptIgnore =\n        (moduleSupport && !!scriptTag.match(SCRIPT_NO_MODULE_REGEX)) || (!moduleSupport && isModuleScript);\n      // in order to keep the exec order of all javascripts\n\n      const matchedScriptTypeMatch = scriptTag.match(SCRIPT_TYPE_REGEX);\n      const matchedScriptType = matchedScriptTypeMatch && matchedScriptTypeMatch[2];\n      if (!isValidJavaScriptType(matchedScriptType)) {\n        return match;\n      }\n\n      // if it is a external script\n      if (SCRIPT_TAG_REGEX.test(match) && scriptTag.match(SCRIPT_SRC_REGEX)) {\n        /*\n         collect scripts and replace the ref\n         */\n\n        const matchedScriptEntry = scriptTag.match(SCRIPT_ENTRY_REGEX);\n        const matchedScriptSrcMatch = scriptTag.match(SCRIPT_SRC_REGEX);\n        let matchedScriptSrc = matchedScriptSrcMatch && matchedScriptSrcMatch[2];\n\n        if (entry && matchedScriptEntry) {\n          throw new SyntaxError(\"You should not set multiply entry script!\");\n        } else {\n          // append the domain while the script not have an protocol prefix\n          if (matchedScriptSrc && !hasProtocol(matchedScriptSrc)) {\n            matchedScriptSrc = getEntirePath(matchedScriptSrc, baseURI);\n          }\n\n          entry = entry || (matchedScriptEntry && matchedScriptSrc);\n        }\n\n        if (scriptIgnore) {\n          return genIgnoreAssetReplaceSymbol(matchedScriptSrc || \"js file\");\n        }\n\n        if (moduleScriptIgnore) {\n          return genModuleScriptReplaceSymbol(matchedScriptSrc || \"js file\", moduleSupport);\n        }\n\n        if (matchedScriptSrc) {\n          const isAsyncScript = !!scriptTag.match(SCRIPT_ASYNC_REGEX);\n          const isDeferScript = !!scriptTag.match(DEFER_ASYNC_REGEX);\n          scripts.push(\n            isAsyncScript || isDeferScript\n              ? {\n                  async: isAsyncScript,\n                  defer: isDeferScript,\n                  src: matchedScriptSrc,\n                  module: isModuleScript,\n                  crossorigin: !!isCrossOriginScript,\n                  crossoriginType: crossOriginType,\n                  attrs: parseTagAttributes(match),\n                }\n              : {\n                  src: matchedScriptSrc,\n                  module: isModuleScript,\n                  crossorigin: !!isCrossOriginScript,\n                  crossoriginType: crossOriginType,\n                  attrs: parseTagAttributes(match),\n                }\n          );\n          return genScriptReplaceSymbol(\n            matchedScriptSrc,\n            (isAsyncScript && \"async\") || (isDeferScript && \"defer\") || \"\"\n          );\n        }\n\n        return match;\n      } else {\n        if (scriptIgnore) {\n          return genIgnoreAssetReplaceSymbol(\"js file\");\n        }\n\n        if (moduleScriptIgnore) {\n          return genModuleScriptReplaceSymbol(\"js file\", moduleSupport);\n        }\n\n        // if it is an inline script\n        const code = getInlineCode(match);\n\n        // remove script blocks when all of these lines are comments.\n        const isPureCommentBlock = code.split(/[\\r\\n]+/).every((line) => !line.trim() || line.trim().startsWith(\"//\"));\n\n        if (!isPureCommentBlock && code) {\n          scripts.push({\n            src: \"\",\n            content: code,\n            module: isModuleScript,\n            crossorigin: !!isCrossOriginScript,\n            crossoriginType: crossOriginType,\n            attrs: parseTagAttributes(match),\n          });\n        }\n\n        return inlineScriptReplaceSymbol;\n      }\n    });\n\n  let tplResult = {\n    template,\n    scripts,\n    styles,\n    // set the last script as entry if have not set\n    entry: entry || scripts[scripts.length - 1],\n  };\n  if (typeof postProcessTemplate === \"function\") {\n    tplResult = postProcessTemplate(tplResult);\n  }\n\n  return tplResult;\n}\n"],"mappings":"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"}